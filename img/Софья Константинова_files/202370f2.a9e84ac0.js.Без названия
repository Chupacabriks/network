"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[2249],{437045:(e,t,i)=>{i.d(t,{StickersAnimation:()=>o});var s=i(581197);let o=function(){let e,t,i,n=!1,r=!1,a={},c={},d={},l={};const h={};function u(e){let t=e.getAttribute("data-uid");return t||(t=Math.random().toString(32).substr(2),e.setAttribute("data-uid",t)),t}function g(e,t){h[u(e)]=t}function p(e){let t=e.getAttribute("data-uniq-id");if(!e.querySelector(".svg_sticker_animation"))return!1;let i=d[t];return i||!1}function f(e){if(h[u(e)])return;g(e,!0);let t=p(e),n=e.getAttribute("data-uniq-id");const r=e.getAttribute("data-uid");if(e.classList.contains("animation_play"))return;let l=e.getAttribute("data-animation-path"),f=e.getAttribute("data-sticker-id"),m=!1;const _=c[f];if(f&&(m=(_||l)&&v(e)),m){const h=e.getAttribute("data-animation-class")||"";let u={containers:[e],loop:!0,autoplay:!0,name:r,group:"sticker",lazyLoading:!1,className:`svg_sticker_animation ${h}`};_?u.animationData=_:u.animationUrl=l;let g=e.querySelector(".svg_sticker_animation");g&&g.remove(),t=i.loadAnimation(u),a[f]||t.then((t=>{const i=t.animationData;c[f]=i,d[n]=t,t.addEventListener("firstFrame",(()=>{const t=e.querySelector(".sticker_img");t&&(0,s.hide)(t),e.classList.add("animation_play")}),{once:!0}),t.addEventListener("destroy",(()=>{o.stopAnimation(e)}))})).catch((()=>null))}}function m(){return t().then((e=>(i=e,i)))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){let t=document.getElementById("fc_msg"+e),i=t?t.querySelector(".sticker_animation"):null;o.loadAndPlaySticker(i)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){let t=$(`.msg_id_${e} .sticker_animation`);o.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){let i="_msg"+e;t&&(i="msg_id_"+e);const s=document.querySelector(`.${i}`);let n=s?s.querySelector(".sticker_animation"):null;o.loadAndPlayStickerWithTimer(n,500)},loadAutoplayAnimationStickers:function(e){if(!i)return void m().then((()=>{o.loadAutoplayAnimationStickers(e)}));if(e){if(r)return;r=!0}if(n)return;n=!0;let t=document.querySelectorAll(".sticker_animation_autoplay");t&&each(t,(function(e,t){f(t)})),n=!1},loadAndPlaySticker:function(e){e&&(i?requestAnimationFrame((()=>{f(e)})):m().then((()=>{o.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(!e)return;if(l[e])return;t||(t=1e3);let i=document.getElementById(e);i?.classList.contains("sticker_animation_disabled_timer")||(l[e]=setTimeout((function(){!i&&(i=document.getElementById(e),i?.classList.contains("sticker_animation_disabled_timer"))||(o.loadAndPlaySticker(i),clearTimeout(l[e]),l[e]=!1)}),t))},reloadStickers:function(){d={}},touchStartSticker:function(t){t.addEventListener("contextmenu",o.preventContextMenu,!1),e=setTimeout((function(){o.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()},stopAnimation(e){const t=p(e);t&&t.pause();const i=e.getAttribute("data-uniq-id");e.classList.remove("animation_play");const o=e.querySelector(".sticker_img");o&&(0,s.show)(o),g(e,!1),delete d[i]}};function v(e){let t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;return t<window.innerHeight&&i>=0&&"none"!==e.style.display}}()},791233:(e,t,i)=>{i.d(t,{StickersAnimation:()=>o.StickersAnimation});var s=i(8520),o=i(437045);o.StickersAnimation.init({animatorLoader:()=>(0,s.asyncImportLoader)((()=>Promise.all([i.e(42135),i.e(23666)]).then(i.bind(i,804046)).then((({LottieManager:e})=>e))))})},968351:(e,t,i)=>{i.d(t,{InitOptionsProvider:()=>n,useInitOptions:()=>r});var s=i(296540);const o=(0,s.createContext)({}),n=o.Provider;function r(){const{payload:e,...t}=(0,s.useContext)(o);return{...e,...t}}},636843:(e,t,i)=>{i.d(t,{stickers:()=>s});const s=(0,i(32489).createDomain)()},590162:(e,t,i)=>{i.d(t,{$isBuying:()=>a,buyFx:()=>r});var s=i(365006),o=i(636843),n=i(459350);const r=o.stickers.createEffect((async e=>{const t=window.Stickers.Cart.create([n.RANDOM_PRODUCT_ID]);await t.load();let i=null;try{i=await t.order({v:s.API_VERSION,ignoreEmptyError:!0,emptyErrorLoader:!1,randomStickerPackAttemptId:e})}catch{}return i&&i.random_selector_result&&!i.error?i:null})),a=o.stickers.createStore(!1).on(r,(()=>!0)).on(r.finally,(()=>!1))},553560:(e,t,i)=>{i.d(t,{hideSnackbar:()=>n,showSnackbar:()=>o});var s=i(32489);const o=(0,s.createEvent)(),n=(0,s.createEvent)()},459350:(e,t,i)=>{i.d(t,{RANDOM_PRODUCT_ID:()=>s,StickersGroup:()=>n,StickersReferrer:()=>r,UGC_STICKERS_APP_ID:()=>o});const s=10101,o=51538586;var n,r;!function(e){e.LAYER="layer"}(n||(n={})),function(e){e.TYPE_STICKERS_KEYBOARD="stickers_keyboard2"}(r||(r={}))},141324:(e,t,i)=>{i.d(t,{openProductModal:()=>s});const s=i(636843).stickers.createEvent()},865014:(e,t,i)=>{i.d(t,{openRandomSelectorPacksModal:()=>s});const s=i(636843).stickers.createEvent()},522267:(e,t,i)=>{i.d(t,{openRandomSelectorResultModal:()=>s});const s=i(636843).stickers.createEvent()},444091:(e,t,i)=>{i.d(t,{ViewId:()=>s,views:()=>l});var s,o=i(296540);i(517101);!function(e){e.LAYER="layer",e.LAYER_PURCHASE_DETAILS="layer_purchase_details",e.RANDOM_SELECTOR="random_selector",e.RANDOM_SELECTOR_PACKS="RANDOM_SELECTOR_packs",e.RANDOM_SELECTOR_RESULT="RANDOM_SELECTOR_result"}(s||(s={}));const n=(0,o.lazy)((()=>Promise.all([i.e(91498),i.e(89631),i.e(762),i.e(42135),i.e(1195),i.e(52731)]).then(i.bind(i,568327)).then((({Layer:e})=>({default:e}))))),r=(0,o.lazy)((()=>Promise.all([i.e(91498),i.e(16846)]).then(i.bind(i,491893)).then((({PurchaseDetails:e})=>({default:e}))))),a=(0,o.lazy)((()=>Promise.all([i.e(91498),i.e(89631),i.e(762),i.e(42135),i.e(64273)]).then(i.bind(i,786622)).then((({Main:e})=>({default:e}))))),c=(0,o.lazy)((()=>Promise.all([i.e(91498),i.e(89631),i.e(762),i.e(1195),i.e(12318)]).then(i.bind(i,935102)).then((({Packs:e})=>({default:e}))))),d=(0,o.lazy)((()=>Promise.all([i.e(91498),i.e(89631),i.e(762),i.e(71409)]).then(i.bind(i,10466)).then((({Result:e})=>({default:e}))))),l=new Map([["layer",{Component:n,width:640}],["layer_purchase_details",{Component:r}],["random_selector",{Component:a}],["RANDOM_SELECTOR_packs",{Component:c}],["RANDOM_SELECTOR_result",{Component:d}]])},517101:(e,t,i)=>{i(239866)},239866:(e,t,i)=>{var s=i(32489),o=i(432465),n=i(553560);const r=(0,s.createEffect)((({title:e,subtitle:t,action:i,timeout:s,onClose:n})=>{(0,o.showSnackbar)({text:e,subtitle:t,timeout:s,action:i,onClose:n})}));(0,s.sample)({clock:n.showSnackbar,target:r});const a=(0,s.createEffect)((e=>{(0,o.hideSnackbar)(e)}));(0,s.sample)({clock:n.hideSnackbar,target:a})},574061:(e,t,i)=>{i.d(t,{openView:()=>a});var s=i(474848),o=i(444091),n=i(968351),r=i(211413);async function a(e){const{view:t,modalBoxOptions:i}=e,{width:a,Component:c}=o.views.get(t)||{};if(c)return(0,r.showMessageBoxModalSuspense)((({onClose:t,refreshCoordinates:i})=>(0,s.jsx)(n.InitOptionsProvider,{value:{payload:{},...e,init:i,destroy:t},children:(0,s.jsx)(c,{})})),{width:a,...i})}},878769:(e,t,i)=>{i.d(t,{openLayerPurchaseDetails:()=>n});var s=i(444091),o=i(574061);function n(e){return(0,o.openView)({payload:e,view:s.ViewId.LAYER_PURCHASE_DETAILS})}},1497:(e,t,i)=>{i.d(t,{openStickersLayerView:()=>d});var s=i(32489),o=i(444091),n=i(574061),r=i(878769),a=i(636843),c=i(141324);async function d(e){const{modalBoxOptions:t}=e;return(0,n.openView)({payload:{...e,onPurchaseDetailsOpen:e=>(0,r.openLayerPurchaseDetails)({details:e})},modalBoxOptions:t,view:o.ViewId.LAYER})}const l=a.stickers.createEffect(d);(0,s.sample)({clock:c.openProductModal,target:l})},848118:(e,t,i)=>{i.d(t,{openStickersRandomSelectorView:()=>m});var s=i(32489),o=i(574061),n=i(444091),r=i(636843),a=i(590162),c=i(865014),d=i(522267),l=i(493711),h=i(246429);const u={},g=r.stickers.createEvent(),p=r.stickers.createStore(u).reset(g),f=r.stickers.createEffect((e=>{(0,h.hideBoxLoader)(),(0,o.openView)({...e,view:n.ViewId.RANDOM_SELECTOR,modalBoxOptions:{onDestroy:()=>{e.modalBoxOptions?.onDestroy?.(),g()}},payload:{onGift:()=>{(0,l.showGiftModal)({giftId:10101,recipientIds:e.payload?.recipientIds??[]})}}})})),m=r.stickers.createEvent();(0,s.sample)({clock:m,target:p}),(0,s.sample)({source:p,filter:e=>e!==u,target:f});const v=r.stickers.createEffect((()=>{(0,o.openView)({view:n.ViewId.RANDOM_SELECTOR_PACKS})}));(0,s.sample)({clock:c.openRandomSelectorPacksModal,target:v});const _=r.stickers.createEffect((()=>{(0,o.openView)({view:n.ViewId.RANDOM_SELECTOR_RESULT})}));(0,s.sample)({clock:d.openRandomSelectorResultModal,target:_}),(0,s.sample)({clock:a.buyFx.finally,source:p,filter:()=>!(0,h.curBox)(),fn:e=>({...e,payload:{...e.payload,preventReload:!0}}),target:f})},876866:(e,t,i)=>{i.d(t,{asyncComponent:()=>s.asyncComponent});var s=i(725669)},317151:(e,t,i)=>{i.d(t,{ajax:()=>s.ajax});var s=i(761520)},982512:(e,t,i)=>{i.d(t,{showSnackbar:()=>s.showSnackbar});var s=i(432465)},677006:(e,t,i)=>{i.d(t,{isVKCOMProfileRedesignedEnabled:()=>s.isVKCOMProfileRedesignedEnabled});var s=i(120101)},80624:(e,t,i)=>{i.d(t,{GiftModal:()=>L});var s=i(474848),o=i(296540),n=i(456921),r=i(694244),a=i(784434),c=i(787744),d=i(753457),l=i(63614),h=i(524378),u=i(44544),g=i(194528),p=i(945206),f=i(944048),m=i(908242),v=i(454154),_=i(8520),b=i(835077),S=i(149333),A=i(132028),y=i(982512),k=i(556533),C=i(669462),M=i(631819);const R=(0,n.observer)((()=>{const e=(0,S.useLangs)(),t=(0,k.useGiftModalModel)(),{props:i,gift:n,isLoading:A,loadError:R,price:L,recipients:w,balance:I,message:E,isPrivate:P,isSending:x,confirmation:G,sendError:B,isSent:O}=t;if((0,o.useEffect)((()=>{i?.refreshCoordinates()})),(0,o.useEffect)((()=>{if(!A){if(!n||R)return(0,y.showSnackbar)({type:"error",text:e.getLang("gifts_gift_modal_load_error_not_found"),timeout:3e3}),void i?.onClose();if(!B)return O?((0,y.showSnackbar)({type:"ok",text:e.getLang("gifts_gift_sent"),timeout:3e3}),void i?.onClose()):void 0;(0,y.showSnackbar)({type:"error",text:e.getLang("gifts_server_error"),timeout:3e3})}}),[A,n,R,B,O]),A)return i?.refreshCoordinates?(0,s.jsx)(b.MessageBoxModalLoader,{refreshCoordinates:i.refreshCoordinates}):void 0;if(!n||R||B||O)return;if(G){const e=e=>{t.send(i?.ref,!0,e)};return(0,s.jsx)(b.MessageBoxModal,{onDestroy:()=>{t.cancelSend()},children:t=>(0,s.jsx)(M.GiftConfirmationModal,{...t,gift:n,confirmation:G,onConfirm:e,isSending:x})})}const j=x,{title:D,description:F}=n,T=t.getImage(256,256,window.devicePixelRatio),N=T??t.getImage(128,128,window.devicePixelRatio);return(0,s.jsxs)(r.ModalBox,{children:[(0,s.jsx)(a.ModalHeaderHero,{onClose:i?.onClose??_.noop,closeAriaLabel:e.getLang("global_close"),icon:N&&(0,s.jsx)(c.ImageBase,{src:N.url,size:T?256:128,withTransparentBackground:!0,noBorder:!0}),description:(0,s.jsxs)(s.Fragment,{children:[F&&(0,s.jsx)(d.Footnote,{children:F}),L&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.Footnote,{children:[e.getLang("gifts_gift_price_label")," ",L," ",e.numeric(L,e.getLang("votes_flex",!0))]}),void 0!==I&&(0,s.jsxs)(d.Footnote,{children:[e.getLang("gifts_your_balance")," ",e.numeric(I,e.getLang("global_n_votes",!0))]})]})]}),children:D}),(0,s.jsx)(l.ModalBody,{insetLevel:2,children:(0,s.jsxs)(h.FormLayout,{children:[(0,s.jsx)(u.FormItem,{top:e.getLang("gifts_receivers"),disabled:j,noPadding:!0,children:(0,s.jsx)(C.GiftRecipientsSelect,{value:[...w],isDisabled:j,onChange:e=>{t.setRecipients(e)},isFocused:!1})}),(0,s.jsx)(g.Spacing,{size:18}),(0,s.jsx)(u.FormItem,{top:e.getLang("gifts_your_message"),disabled:j,noPadding:!0,children:(0,s.jsx)(p.Textarea,{rows:4,value:E,disabled:j,onChange:e=>{t.setMessage(e.target.value)}})}),(0,s.jsx)(g.Spacing,{size:18}),(0,s.jsx)(u.FormItem,{disabled:j,noPadding:!0,children:(0,s.jsx)(f.Checkbox,{checked:P,disabled:j,onChange:e=>{t.setIsPrivate(Boolean(e.target.checked))},children:e.getLang("gifts_receiver_only")})})]})}),(0,s.jsx)(m.ModalFooter,{actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Button,{size:"m",mode:"secondary",onClick:i?.onClose,disabled:j,children:e.getLang("global_cancel")}),(0,s.jsx)(v.Button,{size:"m",onClick:()=>{t.send(i?.ref)},loading:x,disabled:!w.length,children:e.getLang("box_send")})]})})]})})),L=(0,A.createWidget)(k.GiftModalModelProvider,R)},678345:(e,t,i)=>{i.d(t,{GiftConfirmationModal:()=>g});var s=i(474848),o=i(296540),n=i(694244),r=i(168050),a=i(63614),c=i(373080),d=i(908242),l=i(454154),h=i(149333),u=i(523417);const g=({confirmation:e,onConfirm:t,isSending:i,onClose:g,refreshCoordinates:p})=>{const f=(0,h.useLangs)();(0,o.useEffect)((()=>{p()}));let m="";if(function(e){return"text"in e}(e))m=e.text;else if(function(e){return"price"in e}(e)){const{price:t,balance:i}=e;m=f.numeric(t,f.getLang("gifts_send_confirm",!0)),i&&(m+=` ${f.getLang("gifts_your_balance")} ${f.numeric(i,f.getLang("global_n_votes",!0))}`)}else(0,u.expectNever)(e);return(0,s.jsxs)(n.ModalBox,{children:[(0,s.jsx)(r.ModalHeaderCard,{title:f.getLang("gifts_confirmation_modal_title"),onClose:g,closeAriaLabel:f.getLang("global_close")}),(0,s.jsx)(a.ModalBody,{insetLevel:2,children:(0,s.jsx)(c.InnerHTML,{children:m})}),(0,s.jsx)(d.ModalFooter,{actions:[(0,s.jsx)(l.Button,{size:"m",mode:"secondary",disabled:i,onClick:g,children:f.getLang("global_cancel")},"cancel"),(0,s.jsx)(l.Button,{size:"m",onClick:()=>t(),loading:i,children:f.getLang("box_send")},"ok")]})]})}},631819:(e,t,i)=>{i.d(t,{GiftConfirmationModal:()=>s.GiftConfirmationModal});var s=i(678345)},493711:(e,t,i)=>{i.d(t,{showGiftModal:()=>s.showGiftModal});i(80624);var s=i(648609)},602907:(e,t,i)=>{i.d(t,{getVotes:()=>o});var s=i(317151);async function o(e,t){return new Promise(((i,o)=>{window.cur.paymentsHideLastBoxOnly=!0,s.ajax.post("al_gifts.php",{act:"do_send",number:e,mids:t.join(","),check_only:!0},{onDone:()=>{i()},onFail:e=>{void 0===e&&window.cur.paymentSuccess||o(e)}})}))}},556533:(e,t,i)=>{i.d(t,{GiftModalModelProvider:()=>u,useGiftModalModel:()=>g});var s=i(331635),o=i(327813),n=i(8520),r=i(224968),a=i(510964),c=i(132028),d=i(677006),l=i(602907);class h{[c.init](e){this[c.update](e)}[c.update](e){this.props=e;const{giftId:t,recipientIds:i=[]}=e;t!==this.giftId&&(this.loadGift(t),this.loadBalance()),i!==this.recipientIds&&(i.length||this.recipientIds.length)&&this.loadRecipients(i)}async loadGift(e){this.giftAbortController?.abort(void 0),this.giftAbortController=new AbortController,this.giftId=e,this.isLoadingGift=!0;try{const t=await this.giftService.fetchGift(e,this.giftAbortController.signal);(0,o.runInAction)((()=>{e===this.giftId&&(this.gift=t,this.isLoadingGift=!1,this.giftError=void 0)}))}catch(t){console.error(t),(0,o.runInAction)((()=>{e===this.giftId&&(this.gift=void 0,this.isLoadingGift=!1,this.giftError=t)}))}}async loadBalance(){this.balanceAbortController?.abort(void 0),this.balanceAbortController=new AbortController,this.isLoadingBalance=!0;try{const e=await this.giftService.fetchBalance(this.balanceAbortController.signal);(0,o.runInAction)((()=>{this.balance=e,this.isLoadingBalance=!1,this.balanceError=void 0}))}catch(e){console.error(e),(0,o.runInAction)((()=>{this.balance=void 0,this.isLoadingBalance=!1,this.balanceError=e}))}}async loadRecipients(e){this.recipientsAbortController?.abort(void 0),this.recipientsAbortController=new AbortController,this.recipients=[],this.recipientIds=e,this.isLoadingRecipients=!0;try{const t=await this.giftRecipientsProvider.fetchSelectedGiftRecipients(e,this.recipientsAbortController.signal);(0,o.runInAction)((()=>{this.recipientIds===e&&(this.isLoadingRecipients=!1,this.recipients=t,this.recipientsError=void 0,this.recipientsAbortController=void 0)}))}catch(t){console.error(t),(0,o.runInAction)((()=>{this.recipientIds===e&&(this.isLoadingRecipients=!1,this.recipientsError=t,this.recipientsAbortController=void 0)}))}}get isLoading(){return this.isLoadingGift||this.isLoadingBalance||this.isLoadingRecipients}get loadError(){return this.giftError??this.balanceError??this.recipientsError}getImage(e,t,i=1){return this.gift?.images.find((s=>s.width>=e*i&&s.height>=t*i))}setRecipients(e){this.recipients=e}get price(){if(!this.gift)return;const{price:e}=this.gift;return e?e*Math.max(this.recipients.length,1):0}[c.destroy](){this.giftId=void 0,this.gift=void 0,this.isLoadingGift=!1,this.giftError=void 0,this.giftAbortController?.abort(void 0),this.giftAbortController=void 0,this.balance=void 0,this.isLoadingBalance=!1,this.balanceError=void 0,this.balanceAbortController?.abort(void 0),this.balanceAbortController=void 0,this.recipientIds=[],this.recipients=[],this.isLoadingRecipients=!1,this.recipientsError=void 0,this.recipientsAbortController?.abort(void 0),this.recipientsAbortController=void 0,this.message="",this.isPrivate=!1,this.isSending=!1,this.sendResult=void 0,this.sendError=void 0}setMessage(e){this.message=e}get messageLength(){return(0,n.encodeHTMLEntities)(this.message).length}setIsPrivate(e){this.isPrivate=e}async send(e,t,i){if(!this.isSending&&this.giftId&&this.recipients.length){this.isSending=!0;try{const s=this.recipients.map((({id:e})=>e)),n=await this.giftService.send({giftIds:[this.giftId],recipientIds:s,message:this.message,isPrivate:this.isPrivate,ref:e,isConfirmed:t,isStickersBonusEnabled:i});if(n.isNeedVotes)return await(0,l.getVotes)(this.giftId,s),this.isSending=!1,await this.send(e,t,i);(0,o.runInAction)((()=>{this.isSending=!1,this.sendResult=n,this.onSend(n)}))}catch(e){(0,o.runInAction)((()=>{this.isSending=!1,this.sendResult=void 0,this.sendError=e}))}}}cancelSend(){(0,o.runInAction)((()=>{this.isSending=!1,this.sendResult=void 0,this.sendError=void 0}))}onSend(e){"profile"===window.cur.module&&(0,d.isVKCOMProfileRedesignedEnabled)()&&this.recipients.find((({id:e})=>e===window.cur.oid))&&(window.Profile?.hideBirthdayBlock(),window.Profile?.updateGiftBlock())}get confirmation(){return this.sendResult?.confirmation}get isSent(){return void 0!==this.sendResult&&!this.sendResult.confirmation}constructor(e,t){this.giftService=e,this.giftRecipientsProvider=t,this.props=void 0,this.giftId=void 0,this.gift=void 0,this.isLoadingGift=!1,this.giftError=void 0,this.giftAbortController=void 0,this.balance=void 0,this.isLoadingBalance=!1,this.balanceError=void 0,this.balanceAbortController=void 0,this.recipientIds=[],this.recipients=[],this.isLoadingRecipients=!1,this.recipientsError=void 0,this.recipientsAbortController=void 0,this.message="",this.isPrivate=!1,this.isSending=!1,this.sendResult=void 0,this.sendError=void 0,(0,o.makeAutoObservable)(this,{props:!1,gift:o.observable.ref,recipientIds:!1,recipients:o.observable.shallow})}}h=(0,s.__decorate)([c.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.GiftService?Object:r.GiftService,void 0===a.GiftRecipientsProvider?Object:a.GiftRecipientsProvider])],h);const{Provider:u,useModel:g}=(0,c.createProvider)(h)},648609:(e,t,i)=>{i.d(t,{showGiftModal:()=>a});var s=i(474848),o=i(876866),n=i(835077);const r=(0,o.asyncComponent)((()=>i.e(52007).then(i.bind(i,753305))),(({GiftModalLegacy:e})=>e));function a(e){(0,n.showMessageBoxModalSuspense)((t=>(0,s.jsx)(r,{...e,...t})),{width:456})}},590394:(e,t,i)=>{i.d(t,{GiftRecipientsSelect:()=>m});var s=i(474848),o=i(296540),n=i(456921),r=i(753457),a=i(303800),c=i(700272),d=i(454154),l=i(751268),h=i(132028),u=i(149333),g=i(455487);function p(e){return{label:e.name||"",value:String(e.id),recipient:e}}const f=(0,n.observer)((()=>{const e=(0,u.useLangs)(),t=(0,g.useGiftRecipientsSelectModel)(),{props:i,searchQuery:n,recipients:h,isLoading:f,hasMore:m,isFocused:v}=t,_=()=>{t.setIsFocused(!0)},b=(0,o.useRef)(null);(0,o.useEffect)((()=>{v&&b.current?.focus()}),[v]);const S=(0,o.useRef)(void 0),A=e=>{e.preventDefault(),e.stopPropagation(),t.loadMore()},y=(0,o.useMemo)((()=>i?.value.map(p)??[]),[i?.value]),k=(0,o.useMemo)((()=>new Set(y.map((({value:e})=>e)))),[y]),C=(0,o.useMemo)((()=>{const e=h.map(p).filter((({value:e})=>!k.has(e)));return m?e.push({label:"",value:"",preset:"loadMore"}):f&&e.push({label:"",value:"",preset:"loading"}),e}),[h,m,f,k]);return(0,s.jsx)(r.ChipsSelect,{mode:"default",disabled:Boolean(i?.isDisabled),value:y,options:C,filterFn:()=>!0,creatable:!1,onChange:e=>{i?.onChange(e.map((({recipient:e})=>e)).filter((e=>void 0!==e))),_()},selectedBehavior:"hide",closeAfterSelect:!1,inputValue:n??"",onInputChange:e=>{const{value:i}=e.target;t.searchQuery=i,S.current&&clearTimeout(S.current),S.current=setTimeout((()=>{t.load()}),300)},getRef:b,onFocus:_,onBlur:()=>{t.setIsFocused(!1)},placeholder:e.getLang("gifts_choose_recipients"),emptyText:e.getLang("gifts_nobody_found"),renderOption:(i,o)=>{const{preset:n,recipient:h}=o;if("loading"===n)return(0,s.jsx)(a.Div,{children:(0,s.jsx)(c.Spinner,{size:"small"})});if("loadMore"===n)return(0,s.jsx)(a.Div,{children:(0,s.jsx)(d.Button,{appearance:"neutral",size:"s",loading:f,onClick:A,children:e.getLang("gifts_gift_modal_recipients_load_more")})});if(!h)return;const u=t.getPhoto(h,40,40,window.devicePixelRatio),g=u&&t.getAvatarBadgePreset(h),p=(0,s.jsx)(l.RichAvatar,{size:40,src:u?.url,children:g&&(0,s.jsx)(l.RichAvatar.BadgeWithPreset,{preset:g})});return(0,s.jsx)(r.CustomSelectOption,{...i,before:p,description:h.description,children:h.name})}})})),m=(0,h.createWidget)(g.GiftRecipientsSelectModelProvider,f)},669462:(e,t,i)=>{i.d(t,{GiftRecipientsSelect:()=>s.GiftRecipientsSelect});var s=i(590394)},455487:(e,t,i)=>{i.d(t,{GiftRecipientsSelectModelProvider:()=>c,useGiftRecipientsSelectModel:()=>d});var s=i(331635),o=i(327813),n=i(510964),r=i(132028);class a{[r.init](e){this[r.update](e)}[r.update](e){return this.props=e,void 0===this.prevSearchQuery&&this.load(),void 0===this.isFocused&&this.setIsFocused(e.isFocused),this}get hasMore(){return void 0!==this.totalCount&&this.recipients.length<this.totalCount}load(){this.searchQuery!==this.prevSearchQuery&&(this.recipients=[],this.totalCount=void 0,this.fetch(this.searchQuery))}loadMore(){const e=this.recipients.length;void 0!==this.totalCount&&e>=this.totalCount||this.fetch(this.prevSearchQuery??"",e)}async fetch(e,t=0){this.abortController?.abort(void 0),this.abortController=new AbortController,this.prevSearchQuery=e,this.isLoading=!0;try{const[i,s]=await(""!==e?this.giftRecipientsProvider.searchGiftRecipients(e,t,25,this.abortController.signal):this.cache.get(t)??this.giftRecipientsProvider.fetchSuggestedGiftRecipients(t,25,this.abortController.signal));(0,o.runInAction)((()=>{e===this.prevSearchQuery&&(""===e&&this.cache.set(t,[i,s]),this.recipients.push(...i),this.totalCount=s,this.isLoading=!1,this.error=void 0,this.abortController=void 0)}))}catch(t){console.error(t),(0,o.runInAction)((()=>{e===this.prevSearchQuery&&(this.isLoading=!1,this.error=t,this.abortController=void 0)}))}}setIsFocused(e){this.isFocused=e}[r.destroy](){this.cache.clear(),this.recipients=[],this.prevSearchQuery=void 0,this.searchQuery="",this.isLoading=!1,this.totalCount=void 0,this.error=void 0,this.abortController?.abort(void 0),this.abortController=void 0,this.isFocused=void 0}getPhoto(e,t,i,s){return e.photos.find((e=>e.width>=t*s&&e.height>=i*s))??e.photos[0]}getAvatarBadgePreset(e){return e.isOnlineMobile?"online-mobile":e.isOnline?"online":void 0}constructor(e){this.giftRecipientsProvider=e,this.props=void 0,this.cache=new Map,this.recipients=[],this.prevSearchQuery=void 0,this.searchQuery="",this.isLoading=!1,this.totalCount=void 0,this.error=void 0,this.abortController=void 0,this.isFocused=void 0,(0,o.makeAutoObservable)(this,{props:o.observable.shallow,recipients:o.observable.shallow})}}a=(0,s.__decorate)([r.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.GiftRecipientsProvider?Object:n.GiftRecipientsProvider])],a);const{Provider:c,useModel:d}=(0,r.createProvider)(a)},711535:(e,t,i)=>{i.d(t,{GIFTS_STICKERS_RANDOM_PACK_GIFT_ID:()=>s});const s=10101},608787:(e,t,i)=>{i.d(t,{Gift:()=>s});class s{constructor(e,t,i,s,o,n,r){this.id=e,this.images=t,this.title=i,this.description=s,this.isDisabled=o,this.price=n,this.limit=r}}},224968:(e,t,i)=>{i.d(t,{GiftService:()=>l});var s=i(331635),o=i(695368),n=i(21632),r=i(91688),a=i(132028),c=i(608787),d=i(711535);class l{async fetchGift(e,t){const i=await this.giftsApi.getCatalogGift({gift_id:e},{signal:t});if(i.length)return this.createGiftFromApiData(i[0])}createGiftFromApiData(e){const t=e.gift?.id;if(!t)return;const i=[[48,e.gift?.thumb_48],[96,e.gift?.thumb_96],[256,e.gift?.thumb_256],[512,e.gift?.thumb_512]].filter((e=>void 0!==e[1])).map((([e,t])=>({width:e,height:e,url:t})));let s,o;return t===d.GIFTS_STICKERS_RANDOM_PACK_GIFT_ID?s=e.description||void 0:o=e.description||void 0,new c.Gift(t,i,s,o,Boolean(e.disabled),e.price??0,e.gifts_left)}async fetchBalance(e){return(await this.accountApi.getBalance({},{signal:e})).votes}async send(e){try{const t=await this.giftsApi.send({gift_id:e.giftIds.join(","),user_ids:e.recipientIds.join(","),message:e.message,privacy:e.isPrivate?1:0,ref:e.ref,confirm:e.isConfirmed?1:0,guid:Math.round(1e6*Math.random())}),i={};return t.confirmation?.price&&(i.confirmation={price:t.confirmation.price,balance:t.confirmation.balance}),i}catch(e){if("api_error"===e.type){const{error_code:t,confirmation_text:i}=e.error;if(t===o.API_ERROR_NEED_CONFIRMATION)return{confirmation:{text:i}};if(t===o.API_ERROR_BALANCE)return{isNeedVotes:!0}}throw e}}constructor(e,t){this.accountApi=e,this.giftsApi=t}}l=(0,s.__decorate)([a.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.AccountApi?Object:n.AccountApi,void 0===r.GiftsApi?Object:r.GiftsApi])],l)},777866:(e,t,i)=>{i.d(t,{GiftRecipient:()=>s});class s{constructor(e,t,i,s,o,n,r){this.id=e,this.name=t,this.description=i,this.photos=s,this.isOnline=o,this.isOnlineMobile=n,this.isDisabled=r}}},510964:(e,t,i)=>{i.d(t,{GiftRecipientsProvider:()=>d});var s=i(331635),o=i(208214),n=i(488709),r=i(132028),a=i(777866);const c="occupation,photo_50,photo_100,online,deactivated";class d{async fetchSelectedGiftRecipients(e,t){if(!e.length)return[];return(await this.usersApi.get({user_ids:e.join(","),fields:c},{signal:t})).map((e=>this.createGiftRecipientFromApiData(e)))}async fetchSuggestedGiftRecipients(e,t,i){const s=await this.friendsApi.get({order:"hints",offset:e,count:t,fields:c},{signal:i});if(s.items.some((e=>e instanceof Object))){const{items:e,count:t}=s;return[e.map((e=>this.createGiftRecipientFromApiData(e))),t]}return[[],0]}async searchGiftRecipients(e,t,i,s){const{items:o,count:n}=await this.usersApi.search({q:e,offset:t,count:i,from_list:"friends",fields:c},{signal:s});return[o.map((e=>this.createGiftRecipientFromApiData(e))),n]}createGiftRecipientFromApiData(e){const t=[e.first_name,e.last_name].filter((e=>void 0!==e)).join(" ")||void 0,i=[[50,e.photo_50],[100,e.photo_100]].filter((e=>void 0!==e[1])).map((([e,t])=>({width:e,height:e,url:t})));return new a.GiftRecipient(e.id,t,e.occupation?.name,i,Boolean(e.online),Boolean(e.online_mobile),Boolean(e.deactivated))}constructor(e,t){this.friendsApi=e,this.usersApi=t}}d=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.FriendsApi?Object:o.FriendsApi,void 0===n.UsersApi?Object:n.UsersApi])],d)},21632:(e,t,i)=>{i.d(t,{AccountApi:()=>r});var s=i(331635),o=i(641569),n=i(132028);class r extends o.ApiNamespace{get namespace(){return"account"}constructor(...e){super(...e),this.getInfo=this.makeMethod("getInfo"),this.setInfo=this.makeMethod("setInfo"),this.getProfileInfo=this.makeMethod("getProfileInfo"),this.getProfileShortInfo=this.makeMethod("getProfileShortInfo"),this.getPrivacySettings=this.makeMethod("getPrivacySettings"),this.setPrivacy=this.makeMethod("setPrivacy"),this.saveInfo=this.makeMethod("saveProfileInfo"),this.deactivate=this.makeMethod("deactivate"),this.getBalance=this.makeMethod("getBalance"),this.hideHelpHint=this.makeMethod("hideHelpHint"),this.getHelpHints=this.makeMethod("getHelpHints"),this.getBanned=this.makeMethod("getBanned"),this.ban=this.makeMethod("ban"),this.unban=this.makeMethod("unban"),this.getSilentModeStatus=this.makeMethod("getSilentModeStatus"),this.startSilentMode=this.makeMethod("startSilentMode"),this.stopSilentMode=this.makeMethod("stopSilentMode")}}r=(0,s.__decorate)([n.scope.global()],r)},208214:(e,t,i)=>{i.d(t,{FriendsApi:()=>r});var s=i(331635),o=i(132028),n=i(641569);class r extends n.ApiNamespace{get namespace(){return"friends"}constructor(...e){super(...e),this.get=this.makeMethod("get"),this.getIds=this.makeMethod("get"),this.getUsers=(e,t)=>this.makeMethod("get")(e.fields?e:{...e,fields:"first_name"},t),this.search=this.makeMethod("search"),this.getLists=this.makeMethod("getLists"),this.add=this.makeMethod("add"),this.delete=this.makeMethod("delete")}}r=(0,s.__decorate)([o.scope.global()],r)},91688:(e,t,i)=>{i.d(t,{GiftsApi:()=>r});var s=i(331635),o=i(641569),n=i(132028);class r extends o.ApiNamespace{get namespace(){return"gifts"}constructor(...e){super(...e),this.getCatalogGift=this.makeMethod("getCatalogGift"),this.send=this.makeMethod("send")}}r=(0,s.__decorate)([n.scope.global()],r)},488709:(e,t,i)=>{i.d(t,{UsersApi:()=>r});var s=i(331635),o=i(641569),n=i(132028);class r extends o.ApiNamespace{get namespace(){return"users"}constructor(...e){super(...e),this.getWithPrefetch=this.makeMethod("get",!0),this.get=this.makeMethod("get"),this.getFollowers=this.makeMethod("getFollowers"),this.search=this.makeMethod("search")}}r=(0,s.__decorate)([n.scope.global()],r)}}]);try{stManager?.done("dist/web/chunks/202370f2.a9e84ac0.js")}catch(e){}