(()=>{"use strict";var e,t,s,i={65514:(e,t,s)=>{s.d(t,{default:()=>u});var i=s(866467),r=s(754866),o=s(972332),_=s(593159),a=s(825199),n=s(540462);function h(e,t){this._inputEl=e,this.setOptions(t),this._opts.history=!!this._opts.historyItems,this._fetchTO=!1,this._candidateQuery="",this._fetchedQuery="",this._suggestions={},(0,o.addEvent)(this._inputEl,"input keyup keydown change valueChanged refresh",this._onInputValueChanged.bind(this)),(0,o.addEvent)(this._inputEl,"click",this._onInputClick.bind(this));let s=(0,r.geByClass1)("_ui_search_button_search",this._parentEl());s&&(0,o.addEvent)(s,"click",function(){this.value()&&(this._hideSuggestions(!0),this._triggerSearch(this.value(),!0)),this._inputEl.focus()}.bind(this))}h.FETCH_DELAY=250,h.FETCH_TIMEOUT=9500,h.SEARCH_TRIGGER_DELAY=200,h.prototype._onInputClick=function(){let e=this.value();!this._isSuggestionsShown()&&!e&&this._opts.history&&this._opts.historyItems&&this._showSuggestions(this._opts.historyItems,!0),!this._isSuggestionsShown()&&e&&this._suggestions[e]&&this._showSuggestions(this._suggestions[e])},h.prototype._onInputValueChanged=function(e){"valueChanged"==e.type&&(this.value()||(this._hideSuggestions(!0),this._triggerSearch(""))),"refresh"==e.type&&(this.value()||this._hideSuggestions(!0)),e.keyCode===o.KEY.DEL?(this._candidateIsNotAppropriateForUser=!0,this._candidateQuery=""):this._candidateIsNotAppropriateForUser=!1;let t=!1;if("keydown"==e.type){if(this._prevCaretPos=this._prevCaretPos||0,this._candidateQuery&&(e.keyCode==o.KEY.TAB||e.keyCode==o.KEY.RIGHT&&this._inputEl.selectionStart==this._inputEl.value.length&&this._prevCaretPos==this._inputEl.selectionStart)&&(this._opts.onlyShowSuggestions||(this._inputEl.value=this._candidateQuery),this._candidateQuery="",this._renderCandidate(),this._hideSuggestions(),this._fetchSuggestions(),e.keyCode==o.KEY.TAB&&(t=!0)),setTimeout(function(){this._prevCaretPos=this._inputEl.selectionStart}.bind(this)),(e.keyCode==o.KEY.UP||e.keyCode==o.KEY.DOWN)&&this._isSuggestionsShown())return this._selectSuggestion(e.keyCode==o.KEY.DOWN),!1;if(e.keyCode==o.KEY.ENTER){const e=this._onAcceptSuggestion();return this._cancelFetchSuggestion(),this._hideSuggestions(!0),void this._triggerSearch(this.value(),!0,void 0,e&&(0,r.domData)(e,"id"))}}else if("keyup"==e.type)switch(e.keyCode){case o.KEY.ESC:this._isSuggestionsShown()?(this._triggerSearch(this.value(),!this._candidateQuery||this._candidateQuery),this._hideSuggestions(!0)):(this._inputEl.value="",this._triggerSearch(""));break;case o.KEY.ENTER:case o.KEY.RIGHT:case o.KEY.LEFT:case o.KEY.TAB:case o.KEY.SHIFT:case o.KEY.CTRL:case o.KEY.ALT:case 35:case 36:case o.KEY.UP:case o.KEY.DOWN:break;default:let e=this.value();e.length>1?(this._fetchSuggestions(),this._renderCandidate()):this._hideSuggestions(!0),this._candidateIsNotAppropriateForUser?this._triggerSearchDelayed(e):this._triggerSearchDelayed(e,this._getFirstSuggestion(e))}if(setTimeout(function(){this.value()||(this._candidateQuery=""),this._renderCandidate()}.bind(this)),t)return!1},h.prototype._onAcceptSuggestion=function(){let e=(0,r.geByClass1)("ui_search_suggestion_selected",this._parentEl());return e&&(0,_.isFunction)(this._opts.onAcceptSuggestion)&&this._opts.onAcceptSuggestion((0,r.domData)(e,"id"),(0,r.domData)(e,"value"),e),e},h.prototype._cancelFetchSuggestion=function(){clearTimeout(this._fetchTimeout),clearTimeout(this._fetchTO),this._fetchTimeout=this._fetchTO=0},h.prototype._selectSuggestion=function(e){let t="ui_search_suggestion_selected",s=(0,r.geByClass1)(t,this._parentEl());if((0,r.removeClass)(s,t),e)s=(0,r.domNS)(s)||(0,r.geByClass1)("ui_search_sugg_list_item",this._parentEl());else{let e=(0,r.geByClass)("ui_search_sugg_list_item",this._parentEl());s=(0,r.domPS)(s)||e[e.length-1]}(0,r.addClass)(s,t),this._candidateQuery="",s&&(0,_.isFunction)(this._opts.onSelectSuggestion)&&this._opts.onSelectSuggestion((0,r.domData)(s,"id"),(0,r.domData)(s,"value"),s),this._opts.onlyShowSuggestions||(this._inputEl.value=(0,r.domData)(s,"value"),this._triggerSearchDelayed(this.value(),!0,void 0,(0,r.domData)(s,"id")))},h.prototype._parentEl=function(){return(0,r.gpeByClass)("_wrap",this._inputEl)},h.prototype._renderCandidate=function(){let e=(0,r.geByClass1)("_ui_search_suggester_shadow",this._parentEl());if(!e)return;let t=this.value();return this._candidateQuery&&0===this._candidateQuery.indexOf(t.toLowerCase())?(e.innerHTML='<span class="ui_search_suggester_shadow_hidden">'+t+"</span>"+this._candidateQuery.substring(t.length),(0,r.show)(e),!0):(e.innerHTML="",(0,r.hide)(e),!1)},h.prototype._isSuggestionsShown=function(){return!!this._suggestionsShown},h.prototype._hideSuggestions=function(e){e&&(this._candidateQuery="",this._renderCandidate());let t=(0,r.geByClass1)("_ui_search_sugg_list",this._parentEl());(0,r.hide)(t),(0,r.hide)((0,r.geByClass1)("_ui_search_suggester_shadow",this._parentEl())),this._onWindowMouseDown&&(0,o.removeEvent)(window,"mousedown",this._onWindowMouseDown),this._renderCandidate(),this._suggestionsShown=!1},h.prototype._showSuggestions=function(e,t){this._hideSuggestions(),e=e||[];let s=(0,_.trim)(this.value());if(0==e.length)return;let a=(0,r.geByClass1)("_ui_search_sugg_list",this._parentEl()),n="";t&&(n+='<div class="ui_search_sugg_history_header">'+i.getLang("global_recent_search_history")+"</div>"),n+="<div>";let h=0,u=this;(0,_.each)(e,(function(e,r){if(s==r[3]&&!u._opts.onlyShowSuggestions)return;let o="";t&&(o='<a class="ui_search_sugg_list_item_remove" data-hash="'+r[4]+'" data-id="'+r[0]+'">'+i.getLang("global_remove_history_search_item")+"</a>"),n+='<div class="ui_search_sugg_list_item '+(t?"ui_search_sugg_list_item_history":"")+'" data-value="'+r[3]+'" data-id="'+r[0]+'">'+r[1]+o+"</div>",h++})),0!=h&&(n+="</div>",a.innerHTML=n,(0,r.show)(a),(0,o.removeEvent)(a,"click"),(0,o.addEvent)(a,"click",function(e){if((0,r.hasClass)(e.target,"ui_search_sugg_list_item_remove")){let t=(0,r.domData)(e.target,"id"),s=(0,r.domData)(e.target,"hash"),i=(0,r.domChildIndex)((0,r.domPN)(e.target));return(0,r.re)((0,r.domPN)(e.target)),this._opts.historyItems.splice(i,1),0==this._opts.historyItems.length&&this._hideSuggestions(),ajax.post("al_search.php",{act:"remove_history_item",hash:s,item_id:t,type:this._opts.type}),!1}if((0,r.hasClass)(e.target,"ui_search_sugg_list_item")){let t=(0,r.domData)(e.target,"value");const s=this._onAcceptSuggestion();this._hideSuggestions(!0),this._opts.onlyShowSuggestions||(this._inputEl.value=t,this._triggerSearch(t,!0,!0,s&&(0,r.domData)(s,"id"))),(0,r.elfocus)(this._inputEl)}}.bind(this)),(0,o.removeEvent)(a,"mousemove"),(0,o.addEvent)(a,"mousemove",(function(e){(0,r.hasClass)(e.target,"ui_search_sugg_list_item")&&((0,r.removeClass)((0,r.geByClass1)("ui_search_suggestion_selected",a),"ui_search_suggestion_selected"),(0,r.addClass)(e.target,"ui_search_suggestion_selected"))})),(0,o.removeEvent)(a,"mouseleave"),(0,o.addEvent)(a,"mouseleave",(function(e){(0,r.removeClass)((0,r.geByClass1)("ui_search_suggestion_selected",a),"ui_search_suggestion_selected")})),this._candidateIsNotAppropriateForUser||t||(this._candidateQuery=e[0][3],this._renderCandidate()||(this._candidateQuery="")),(0,o.addEvent)(window,"mousedown",this._onWindowMouseDown=function(e){(0,r.domClosest)("_wrap",e.target)&&!(0,r.hasClass)(e.target,"_ui_search_params_button")||this._hideSuggestions(!0)}.bind(this)),this._suggestionsShown=!0)},h.prototype._triggerSearchDelayed=function(e,t,s,i){clearTimeout(this._triggerSearchTO);let r=this._opts.search_trigger_delay||h.SEARCH_TRIGGER_DELAY;this._triggerSearchTO=setTimeout(function(){this._triggerSearch(e,t,s,i)}.bind(this),r)},h.prototype._triggerSearch=function(e,t,s,i){e||(t=""),e=(0,_.trim)(e),!0===t&&(t=e),t=void 0!==t?(0,_.trim)(t):t,(void 0===this._lastTriggeredSearch||this._lastTriggeredSearch||e)&&(this._lastTriggeredSearch&&this._lastTriggeredSearch==e&&(this._lastTriggeredSuggestedSearch&&void 0===t||this._lastTriggeredSuggestedSearch==t)||(this._lastTriggeredSearch=e,this._lastTriggeredSuggestedSearch=t,this._opts.onSearch&&this._opts.onSearch(e,t,s,this._fetchedQuery,i)))},h.prototype.value=function(){return(0,_.trim)(this._inputEl.value)?this._inputEl.value:""},h.prototype._getFirstSuggestion=function(e){return!(!this._suggestions[e]||!this._suggestions[e][0])&&this._suggestions[e][0][3]},h.prototype._onSuggestionsFetched=function(e,t){let s=(0,_.trim)(this.value());s==e&&(this._fetchedQuery=e,this._suggestions[e]=t,this._showSuggestions(t),t.length?this._candidateIsNotAppropriateForUser?this._triggerSearch(s):this._triggerSearch(s,!this._candidateQuery||this._candidateQuery):this._triggerSearch(s,!0))},h.prototype.saveHistoryItem=function(e,t,s,i,r){if(!i||!this._opts.history)return;let o=this._opts.historyItems||[];for(let t=0,s=o.length;t<s;t++)if(o[t][1]==e)return;ajax.post("al_search.php",{act:"save_history_item",type:this._opts.type,q:e,object_owner_id:t,object_id:s,total_count:i,total_count_hash:r,hash:this._opts.saveHash},{onDone:function(e){e&&(this._opts.historyItems=e||[])}.bind(this)})},h.prototype.setOptions=function(e,t){this._opts=t?(0,_.extend)(this._opts,e):(0,_.extend)(e,{})},h.prototype._fetchSuggestions=function(){const e=(0,a.ensureAudioSearchSuggestionsService)(),t=(0,n.partConfigEnabled)("audio_search_suggestions_api_web");clearTimeout(this._fetchTO);let s=(0,_.trim)(this.value());s.length<2||((0,_.isFunction)(this._opts.fetchSuggestionsFn)?this._onSuggestionsFetched(s,this._opts.fetchSuggestionsFn(s)):this._fetchTO=setTimeout(function(){this._fetchTimeout=setTimeout(function(){this._fetchTimeout=0,this._onSuggestionsFetched(s,[])}.bind(this),h.FETCH_TIMEOUT),t&&"audio"===this._opts.type?e.fetchFx({query:s}).then((e=>{const t=e.map(((e,t)=>[t+1,e.replace(s,`<em>${s}<em>`),"",e,this._opts.type]));this._fetchTimeout&&(clearTimeout(this._fetchTimeout),this._onSuggestionsFetched(s,t))})):ajax.post("/hints.php",{act:"a_gsearch_hints",q:s,section:this._opts.type},{onDone:function(e){this._fetchTimeout&&(clearTimeout(this._fetchTimeout),this._onSuggestionsFetched(s,e))}.bind(this),cache:1})}.bind(this),h.FETCH_DELAY))};const u=h},157156:(e,t,s)=>{var i=s(636576),r=s(65514);window.vk?.stDomain&&(s.p=window.vk.stDomain+"/dist/"),window.Suggester=r.default,requestIdleCallback((()=>{try{(0,i.statlogsValueEvent)("entries_requests",1,"suggester","web")}catch{}}),{timeout:5e3});try{stManager?.done(partConfigEnabled("web_static_manager_done_with_hash")?"dist/web/suggester.03fe714f.js":"dist/web/suggester.js")}catch(e){}},825199:(e,t,s)=>{s.d(t,{ensureAudioSearchSuggestionsService:()=>_});var i=s(32489),r=s(558137),o=s(938876);const _=(0,r.makeSharedState)("global/audio/searchSuggestions",(()=>(0,o.createAudioSearchSuggestionsService)({domain:(0,i.createDomain)("global/audio/searchSuggestions"),name:"global/audio/searchSuggestions"})),{version:1})},938876:(e,t,s)=>{s.d(t,{createAudioSearchSuggestionsService:()=>o});var i=s(969412),r=s(746573);function o(e){const t=(0,r.getEffectorServiceDomain)(e);return{fetchFx:(0,i.createAudioSearchSuggestionsFetchFx)({domain:t})}}},969412:(e,t,s)=>{s.d(t,{createAudioSearchSuggestionsFetchFx:()=>r});var i=s(580352);function r({domain:e}){const t=(0,i.createAudioGetSearchSuggestionsFx)({domain:e});return e.createEffect((async({query:e,exps:s})=>(await t({query:{query:e,exps:s}})).suggestions))}}},r={};function __webpack_require__(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return i[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}__webpack_require__.m=i,e=[],__webpack_require__.O=(t,s,i,r)=>{if(!s){var o=1/0;for(h=0;h<e.length;h++){for(var[s,i,r]=e[h],_=!0,a=0;a<s.length;a++)(!1&r||o>=r)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](s[a])))?s.splice(a--,1):(_=!1,r<o&&(o=r));if(_){e.splice(h--,1);var n=i();void 0!==n&&(t=n)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[s,i,r]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var r=Object.create(null);__webpack_require__.r(r);var o={};t=t||[null,s({}),s([]),s(s)];for(var _=2&i&&e;"object"==typeof _&&!~t.indexOf(_);_=s(_))Object.getOwnPropertyNames(_).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,__webpack_require__.d(r,o),r},__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",(()=>{var e={42357:0};__webpack_require__.O.j=t=>0===e[t];var t=(t,s)=>{var i,r,[o,_,a]=s,n=0;if(o.some((t=>0!==e[t]))){for(i in _)__webpack_require__.o(_,i)&&(__webpack_require__.m[i]=_[i]);if(a)var h=a(__webpack_require__)}for(t&&t(s);n<o.length;n++)r=o[n],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return __webpack_require__.O(h)},s=self.webpackChunkvkweb=self.webpackChunkvkweb||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=__webpack_require__.O(void 0,[50560,762,81765,23592],(()=>__webpack_require__(157156)));o=__webpack_require__.O(o)})();