"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[68335],{199313:(e,t,i)=>{i.d(t,{FriendsAddResponseEnumNames:()=>s});const s={SEND:1,APPROVED:2,RESEND:4}},957831:(e,t,i)=>{i.d(t,{VideoViewSegmentsResponseEnumNames:()=>s});const s={NOT_LOGGED:0,LOGGED:1,MODEL_UPDATED:2}},642347:(e,t,i)=>{i.d(t,{GroupsGroupAdminLevelEnumNames:()=>s});const s={MODERATOR:1,EDITOR:2,ADMINISTRATOR:3}},897976:(e,t,i)=>{i.d(t,{constructConfig:()=>c,constructSources:()=>d,constructVideoData:()=>h});var s=i(317929),r=i(1100),o=i(807978),n=i(540462);const a={"144p":"mp4_144","240p":"mp4_240","360p":"mp4_360","480p":"mp4_480","720p":"mp4_720","1080p":"mp4_1080","1440p":"mp4_1440","2160p":"mp4_2160"};function d({files:e,live_settings:t}){const i={};let r=t?.playback_duration??t?.max_rewind_duration;r&&(r*=o.SECOND);const d=(0,n.partConfigEnabled)("video_player_support_new_live_links")&&Boolean(t),h=(0,n.partConfigEnabled)("video_player_support_new_live_links")&&!r;if(!e)return i;const c={};for(const[t,i]of Object.entries(a))i in e&&(c[t]=e[i]);return Object.keys(c).length>0?i.MPEG=c:e.src&&(i.MPEG={"Invariant quality":e.src}),e.dash_sep&&(i[s.VideoFormat.DASH_SEP]={type:"url",url:e.dash_sep}),e.dash_webm&&(i[s.VideoFormat.DASH_WEBM]={type:"url",url:e.dash_webm}),e.dash_webm_av1&&(i[s.VideoFormat.DASH_WEBM_AV1]={type:"url",url:e.dash_webm_av1}),e.dash_streams&&(i[s.VideoFormat.DASH_STREAMS]={type:"url",url:e.dash_streams}),e.cmaf&&(i[s.VideoFormat.DASH_LIVE_CMAF]={type:"url",url:e.cmaf}),e.hls&&!d&&(i[s.VideoFormat.HLS]={type:"url",url:e.hls}),e.dash_live&&h&&(i[s.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live}),!e.dash_live_playback||h&&e.dash_live||(i[s.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live_playback}),e.hls_live&&h&&(i[s.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live}),!e.hls_live_playback||h&&e.hls_live||(i[s.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live_playback,maxSeekBackTime:r}),e.dash_ondemand&&(i[s.VideoFormat.DASH_ONDEMAND]={type:"url",url:e.dash_ondemand}),e.hls_ondemand&&(i[s.VideoFormat.HLS_ONDEMAND]={type:"url",url:e.hls_ondemand}),e.hls_live_ondemand&&(i[s.VideoFormat.HLS_LIVE_CMAF]={type:"url",url:e.hls_live_ondemand,maxSeekBackTime:r}),e.ws&&(i[s.VideoFormat.WEB_RTC_LIVE]={type:"url",url:e.ws}),i}function h(e){const t=d(e),i={status:e.live_status,startTime:e.live_start_time},s=e.image?.sort(((e,t)=>e.height-t.height))??[],r=s.find((({height:e})=>e>500))??s.at(-1),o=e.restriction?{restriction:e.restriction}:{};return{...Object.keys(t).length>0?{sources:t}:{live:i},title:e.title??"",thumbUrl:r?.url,unitedVideoId:parseInt(e.ov_id??"0",10),duration:e.duration??0,videoEpisodes:e.episodes?.map((({time:e,text:t})=>({time:e??0,text:t??""}))),previewThumbsData:e.timeline_thumbs?{countPerImage:e.timeline_thumbs.count_per_image??1,countPerRow:e.timeline_thumbs.count_per_row??1,countTotal:e.timeline_thumbs.count_total??1,frameHeight:e.timeline_thumbs.frame_height??0,frameWidth:e.timeline_thumbs.frame_width??0,frequency:e.timeline_thumbs.frequency??1,isUV:e.timeline_thumbs.is_uv??!1,links:e.timeline_thumbs.links??[]}:void 0,subtitles:e.subtitles?.filter((e=>Boolean(e.url))).map((({is_auto:e,title:t,lang:i,manifest_name:s,url:r,storage_index:o})=>({isAuto:e,id:[t,i,o].filter(Boolean).join("_"),language:i,label:s,url:r}))),...o}}function c(e,t){const i=e.map((e=>h(e))),s=e[0],o={videos:i??[]};return t&&(o.interactiveData={...t,videoLoader:async(e,i)=>{const s=t?.accessKeysMap||{};return c((await(0,r.fetchVideo)(parseInt(e,10),parseInt(i,10),s[i]||"")).items)}}),s?.album_id&&(o.albumId=s.album_id.toString(10)),s?.uv_stats_place&&(o.statPlace=s.uv_stats_place),s?.track_code&&(o.statTrackCode=s.track_code),2===s?.can_download&&(o.canDownload=!0),s?.files?.failover_host&&(o.failoverHosts=[s?.files?.failover_host]),s?.restriction?.mute_info_link&&(o.isAudioDisabled=Boolean(s?.restriction?.mute_info_link)),s?.volume_multiplier&&(o.volumeMultiplier=s?.volume_multiplier),o}},1100:(e,t,i)=>{i.d(t,{fetchVideo:()=>o});var s=i(538522),r=i(805658);const o=async(e,t,i,o={})=>(0,r.apiWithPrefetch)("video.get",{owner_id:e,videos:(0,s.joinRawId)({ownerId:e,itemId:t,externalId:i}),extended:1,...o})},940733:(e,t,i)=>{i.d(t,{constructSources:()=>s.constructSources});var s=i(897976)},982540:(e,t,i)=>{i.d(t,{ClipsPlayer:()=>p});var s=i(474848),r=i(296540),o=i(689900),n=i(132028),a=i(456921),d=i(773439),h=i(940733),c=i(779137);const u=new(i(51015).ObjectPool)((()=>{const e=document.createElement("video");return e.muted=!0,e.playsInline=!0,e.disablePictureInPicture=!0,e})),l=(0,a.observer)((function(){const e=(0,c.useClipPlayerModel)(),{loop:t=!0,muted:i,volume:n,playing:a,mode:l,video:p,onLooped:m,onPlayingChanged:g,onPositionChanged:v,onStalledChanged:_,onStarted:b,onVideoCurQualityChanged:f,onVideoEndedChanged:S,onVideoVolumeChanged:y,newCurrentTime:w,onDurationChanged:V,onVideoFormatChanged:P,onVideoBitrateChanged:A,onEnded:C,onFirstBytes:E,onFirstFrame:O}=e.props.current,{setVkPlayer:I,isPlayerHidden:k,vkPlayer:M,unsubscribe:F,subscribe:L,userEnv:T,initOneStat:D,oneStat:R,authorizeOneStat:j,sendViewSegments:N,subscribeViewSegments:U,addPoint:H}=e,[$,x]=(0,r.useState)(null);(0,r.useEffect)((()=>{if(M&&(D(),R))return R.pause(),j(),R.attachTo(M),()=>{R.destroy()}}),[M,p?.ovId]),(0,r.useEffect)((()=>{if(N)return U(),()=>{H(!1),F()}}),[M,H,N]),(0,r.useEffect)((()=>{let t=null,i=null;if(p&&$&&!e.playerConfigData?.loadingConfig){t=new d.Player(e.playerConfigData?.config?.core),i=u.allocate(),$.innerHTML="",$.appendChild(i);const s=(0,h.constructSources)(p);if(T.partConfigEnabled("video_clips_mvk_hls_min_quality_from_backend")){const e=s[d.VideoFormat.HLS];e&&(e.url+="&lq=480")}t.setMuted(!0).setLooped(!0).setAutoQualityLimits({min:d.VideoQuality.Q_480P}).initVideo({container:$,sources:s,failoverHosts:p.files?.failover_host?[p.files.failover_host]:void 0,meta:{videoId:p.ovId}}).prepare()}return I(t),()=>{t?.destroy(),$&&($.innerHTML=""),i&&u.free(i)}}),[p,$,e.playerConfigData]),(0,r.useEffect)((()=>(L(),()=>{F()})),[M,S,g,_,y,b,m,v,f,V,C,E,O,P,A]);const G=(0,r.useCallback)((()=>{M?.play()}),[M]),B=(0,r.useCallback)((()=>{M?.pause()}),[M]),q=(0,r.useCallback)((e=>{M?.setMuted(e)}),[M]),Q=(0,r.useCallback)((e=>{e&&M?.setVolume(e)}),[M]),K=(0,r.useCallback)((e=>{M?.setLooped(e)}),[M]),z=(0,r.useCallback)((e=>{M?.seekTime(e)}),[M]);return(0,r.useEffect)((()=>{a?G():B()}),[a,G,B]),(0,r.useEffect)((()=>{Q(n??0)}),[n,Q]),(0,r.useEffect)((()=>{q(i)}),[i,q]),(0,r.useEffect)((()=>{K(t)}),[t,K]),(0,r.useEffect)((()=>{"number"==typeof w&&z(w)}),[w,z]),(0,s.jsx)(o.ClipPlayerContainer,{mode:l,setContainer:x,hidden:k})})),p=(0,n.createWidget)(c.ClipsPlayerProvider,l)},686106:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>r.ClipPlayerViewModel,ClipsPlayer:()=>s.ClipsPlayer});var s=i(982540),r=i(779137)},141518:(e,t,i)=>{i.d(t,{ClipsPlayerProvider:()=>v,useClipPlayerModel:()=>g});var s=i(331635),r=i(852487),o=i(979549),n=i(291566),a=i(327813),d=i(132028),h=i(24516),c=i(951652),u=i(809424),l=i(773439),p=i(89923);class m{async[d.init](){this.getConfig()}get isPlayerHidden(){return this._isPlayerHidden}async getConfig(){const e=this.props.current.module??"clips",t=await this.videoPlayerConfigProvider.ensure({module:e});(0,a.runInAction)((()=>{this.playerConfigData={config:t,loadingConfig:!1}}))}get vkPlayer(){return this._vkPlayer}get oneStat(){return this._oneStat}constructor(e,t,i,s,r,o,n){this.props=e,this.videoPlayerConfigProvider=t,this.userEnv=i,this.videoViewSegmentsService=s,this.stats=r,this.authService=o,this.metaData=n,this.playerConfigData={config:null,loadingConfig:!0},this._vkPlayer=null,this._isPlayerHidden=!0,this.segment=[],this.setPlayerVisible=()=>{this._isPlayerHidden=!1},this.sendViewSegments=e=>{const{id:t,ownerId:i,trackCode:s=""}=this.props.current.video;t&&i&&this.videoViewSegmentsService.send({video_id:t,owner_id:i,ranges:e,ref:"clips",muted:this.props.current.muted?1:0,track_code:s})},this.refreshAuthToken=async()=>{if(this.authService.isAuthorized)try{return await this.stats.getToken({refresh:!0})}catch{await this.stats.trackOneStatError("video.getStatsToken")}},this.authorizeToken=async()=>{try{return await this.stats.getToken({refresh:!0})}catch{await this.stats.trackOneStatError("video.getStatsToken")}},this.subscribe=()=>{this.subs=new l.Subscription,this.vkPlayer&&(this.props.current.onStalledChanged&&this.subs.add(this.vkPlayer.info.isStalled$.subscribe(this.props.current.onStalledChanged)),this.props.current.onVideoEndedChanged&&this.subs.add(this.vkPlayer.info.isEnded$.subscribe(this.props.current.onVideoEndedChanged)),this.props.current.onLooped&&this.subs.add(this.vkPlayer.events.looped$.subscribe(this.props.current.onLooped)),this.props.current.onVideoVolumeChanged&&this.subs.add(this.vkPlayer.info.volume$.subscribe(this.props.current.onVideoVolumeChanged)),this.subs.add(this.vkPlayer.info.currentQuality$.subscribe((e=>e!==l.VideoQuality.INVARIANT&&this.props.current.onVideoCurQualityChanged&&this.props.current.onVideoCurQualityChanged(e)))),this.props.current.onDurationChanged&&this.subs.add(this.vkPlayer.info.duration$.subscribe(this.props.current.onDurationChanged)),this.props.current.onPositionChanged&&this.subs.add(this.vkPlayer.info.position$.subscribe(this.props.current.onPositionChanged)),this.props.current.onPlayingChanged&&(this.subs.add(this.vkPlayer.events.playing$.subscribe((()=>this.props.current.onPlayingChanged&&this.props.current.onPlayingChanged(!0)))),this.subs.add(this.vkPlayer.events.paused$.subscribe((()=>this.props.current.onPlayingChanged&&this.props.current.onPlayingChanged(!1))))),this.props.current.onStarted&&this.subs.add(this.vkPlayer.events.started$.subscribe(this.props.current.onStarted)),this.props.current.onFirstBytes&&this.subs.add(this.vkPlayer.events.firstBytes$.subscribe(this.props.current.onFirstBytes)),this.subs.add(this.vkPlayer.events.firstFrame$.subscribe((e=>{this.setPlayerVisible(),this.props.current.onFirstFrame&&this.props.current.onFirstFrame(e)}))),this.props.current.onVideoFormatChanged&&this.subs.add(this.vkPlayer.info.currentFormat$.subscribe(this.props.current.onVideoFormatChanged)),this.props.current.onVideoBitrateChanged&&this.subs.add(this.vkPlayer.info.videoBitrate$.subscribe(this.props.current.onVideoBitrateChanged)),this.props.current.onEnded&&(this.subs.add(this.vkPlayer.events.ended$.subscribe(this.props.current.onEnded)),this.subs.add(this.vkPlayer.events.looped$.subscribe(this.props.current.onEnded))),this.props.current.onCurrentTimeChanged&&(this.subs.add(this.vkPlayer.events.started$.subscribe((()=>{this.props.current.onCurrentTimeChanged&&this.props.current.onCurrentTimeChanged(0)}))),this.subs.add(this.vkPlayer.info.position$.subscribe((e=>{e&&this.props.current.onCurrentTimeChanged&&this.props.current.onCurrentTimeChanged(e)})))))},this.unsubscribe=()=>{this.subs&&this.subs.unsubscribe()},this.setVkPlayer=e=>{this._vkPlayer=e},this.play=()=>{this._vkPlayer?.play()},this.pause=()=>{this._vkPlayer?.pause()},this.setMuted=e=>{this._vkPlayer?.setMuted(e)},this.setVolume=e=>{e&&this._vkPlayer?.setVolume(e)},this.setLooped=e=>{this._vkPlayer?.setLooped(e)},this.setCurrentTime=e=>{this._vkPlayer?.seekTime(e)},this.initOneStat=()=>{this._oneStat=new p.OneStat({movieId:Number(this.props.current.video?.ovId),place:this.metaData.get().module??"",mobile:"mvk"===this.props.current.platform,autoplay:!0},{apiEnv:p.ApiEnv.PROD,refreshAuthToken:this.refreshAuthToken,config:{apiEnv:p.ApiEnv.PROD,requestRetryCount:1}})},this.authorizeOneStat=async()=>{const e=await this.authorizeToken();this.authService.isAuthorized&&e?(this._oneStat.authorize(e),this._oneStat.resume()):(this._oneStat.authorize(),this._oneStat.resume())},this.addPoint=e=>{if(this.vkPlayer){if(e)this.segment=[];else if(!this.segment.length)return;this.segment.push(Math.trunc(this.vkPlayer.info.position$.getValue())),2===this.segment.length&&(this.sendViewSegments(this.segment.join("-")),this.segment=[])}},this.subscribeViewSegments=()=>{this.subs||(this.subs=new l.Subscription),this.vkPlayer&&(this.subs.add(this.vkPlayer.events.playing$.subscribe((()=>this.addPoint(!0)))),this.subs.add(this.vkPlayer.events.paused$.subscribe((()=>this.addPoint(!1)))),this.subs.add(this.vkPlayer.events.willSeek$.subscribe((()=>this.addPoint(!1)))),this.subs.add(this.vkPlayer.events.ended$.subscribe((()=>this.addPoint(!1)))),this.subs.add(this.vkPlayer.events.looped$.subscribe((()=>this.addPoint(!1)))))},(0,a.makeAutoObservable)(this)}}m=(0,s.__decorate)([d.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.Props?Object:d.Props,void 0===r.VideoPlayerConfigProvider?Object:r.VideoPlayerConfigProvider,void 0===h.UserEnv?Object:h.UserEnv,void 0===o.VideoViewSegmentsService?Object:o.VideoViewSegmentsService,void 0===n.ShortVideoStatsTokenService?Object:n.ShortVideoStatsTokenService,void 0===c.AuthService?Object:c.AuthService,void 0===u.MetaData?Object:u.MetaData])],m);const{useModel:g,Provider:v}=(0,d.createProvider)(m)},383346:(e,t,i)=>{i.d(t,{ClipsPlayerProvider:()=>s.ClipsPlayerProvider,useClipPlayerModel:()=>s.useClipPlayerModel});var s=i(141518)},219178:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>r});var s=i(327813);class r{get activeVolume(){return this._activeVolume}get cacheVolume(){return this._cacheVolume}get videoIsEnded(){return this._videoIsEnded}get videoIsMuted(){return this._videoIsMuted}get currentTime(){return this._currentTime}constructor(e,t){this.props=e,this.userEnv=t,this._activeVolume=0,this._cacheVolume=0,this._currentTime=0,this._videoIsEnded=!1,this._videoIsMuted=!1,this.setActiveVolume=e=>{this._activeVolume=e},this.setCacheVolume=e=>{this._cacheVolume=e},this.setVideoIsEnded=e=>{this._videoIsEnded=e},this.setVideoMuted=e=>{this._videoIsMuted=e},this.muteButtonClick=()=>{if(0===this.activeVolume||this.videoIsMuted)return 0===this.cacheVolume?(this.setCacheVolume(this.props.current.volume??1),void this.setActiveVolume(this.props.current.volume??1)):(this.setActiveVolume(this.cacheVolume),void this.setVideoMuted(!1));this.setCacheVolume(this.activeVolume),this.setActiveVolume(0),this.setVideoMuted(!0)},this.volumeChange=e=>{this.setActiveVolume(e),this.setVideoMuted(0===e)},this.setCurrentTime=e=>{this._currentTime=e},(0,s.makeAutoObservable)(this),this._activeVolume=this.props.current.volume??1,this._cacheVolume=this.activeVolume,this._videoIsMuted=this.props.current.muted??!1}}},353129:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>s.ClipPlayerViewModel});var s=i(219178)},779137:(e,t,i)=>{i.d(t,{ClipPlayerViewModel:()=>s.ClipPlayerViewModel,ClipsPlayerProvider:()=>r.ClipsPlayerProvider,useClipPlayerModel:()=>r.useClipPlayerModel});var s=i(353129),r=i(383346)},51015:(e,t,i)=>{i.d(t,{ObjectPool:()=>s});class s{allocate(){const e=[...this.pool.entries()].find((([,e])=>e)),[t]=e||[this.makeItem()];return this.pool.set(t,!1),t}free(e){this.pool.has(e)&&this.pool.set(e,!0)}size(){return this.pool.size}constructor(e){this.makeItem=e,this.pool=new Map}}},749629:(e,t,i)=>{i.d(t,{Q_1080P:()=>r,VIDEO_FETCH_FIELDS:()=>s.SHORT_VIDEO_ALL_FETCH_FIELDS});var s=i(110343);const r="1080p"},521344:(e,t,i)=>{i.d(t,{ClipRestrictionModel:()=>s.ClipRestrictionModel,ClipsFeedModel:()=>s.ClipsFeedModel,ClipsPlayer:()=>o.ClipsPlayer,ClipsPlayerStatusModel:()=>s.ClipsPlayerStatusModel,Q_1080P:()=>r.Q_1080P,UPLOAD_AUDIO_RIGHTS_LINK:()=>n.UPLOAD_AUDIO_RIGHTS_LINK,UploadAudioSearchModel:()=>n.UploadAudioSearchModel,VIDEO_FETCH_FIELDS:()=>r.VIDEO_FETCH_FIELDS,createLink:()=>d.createLink,getClipCover:()=>a.getClipCover,isLockedVideo:()=>a.isLockedVideo});var s=i(270383),r=i(749629),o=i(686106),n=i(41128),a=i(689110),d=i(518235)},687242:(e,t,i)=>{i.d(t,{ClipsFeedModel:()=>_});var s=i(331635),r=i(413206),o=i(882044),n=i(765905),a=i(876922),d=i(338454),h=i(474436),c=i(509739),u=i(914492),l=i(632520),p=i(327813),m=i(132028),g=i(521344),v=i(204361);class _{initFeed(e,t){const i=(0,v.getFeedObjectKey)(e);switch(this.feedFirstClip.delete(i),"top"!==e.feed&&"subscriptions"!==e.feed||!t||(this.feedFirstClip.set(i,t),this.shortVideoVideosFullProvider.fetch({videos:`${t}`,extended:1,fields:g.VIDEO_FETCH_FIELDS.join(",")})),e.feed){case"compilation":case"effect":case"music":case"hashtag":case"place":case"top":this.feedsMap.get(i)?.reset();const t=this.topVideosProvider.createList((0,v.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,t),t.fetch();case"ownerFeed":case"postponed":case"playlist":this.feedsMap.get(i)?.reset();const s=this.ownerVideosProvider.createList((0,v.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,s),s.fetch();case"subscriptions":this.feedsMap.get(i)?.reset();const r=this.newsVideosProvider.createList((0,v.getFeedObjectRequestParams)(e));return this.feedsMap.set(i,r),r.fetch();default:throw new Error(`${e.feed} does not support in ShortVideoPage`)}}getFeedData(e){const t=this.feedsMap.get((0,v.getFeedObjectKey)(e));if(!t)return;const{ids:i,isLoading:s,count:r,fullyLoaded:o,error:n}=t;return{ids:this.processFeedItems(e,i),isLoading:s,count:r,fullyLoaded:o,error:n}}fetchNext(e){return this.feedsMap.get((0,v.getFeedObjectKey)(e))?.fetch()}setFeedFirstClip(e,t){this.feedFirstClip.set((0,v.getFeedObjectKey)(e),t)}processFeedItems(e,t){if(!t.length)return t;const i=this.feedFirstClip.get((0,v.getFeedObjectKey)(e));let s=[...t];return i&&(s=[i,...s.filter((e=>e!==i))]),"top"!==e.feed&&"subscriptions"!==e.feed||(s=s.filter((e=>!this.shortVideoDeleteService.isDeleted(e)))),"subscriptions"===e.feed&&(s=s.filter((e=>this.shortVideoOwnersFullProvider.get(this.shortVideoVideosFullProvider.get(e)?.data.owner_id??0)?.isSubscribed))),s}constructor(e,t,i,s,r,o,n,c){this.shortVideoApi=e,this.videoApi=t,this.feedApi=i,this.shortVideoDeleteService=s,this.shortVideoOwnersFullProvider=r,this.shortVideoVideosFullProvider=o,this.shortVideoVideosProvider=n,this.shortVideoOwnersProvider=c,this.feedsMap=new Map,this.feedFirstClip=new Map,this.topVideosProvider=new a.ShortVideoFeedTopVideosProvider(this.shortVideoApi,this.shortVideoVideosProvider,this.shortVideoOwnersProvider),this.ownerVideosProvider=new d.ShortVideoFeedOwnerVideosProvider(this.shortVideoApi,this.shortVideoVideosProvider,this.shortVideoOwnersProvider),this.newsVideosProvider=new h.ShortVideoFeedNewsVideosProvider(this.videoApi,this.feedApi,this.shortVideoVideosProvider,this.shortVideoOwnersProvider),(0,p.makeAutoObservable)(this)}}_=(0,s.__decorate)([m.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoApi?Object:r.ShortVideoApi,void 0===o.VideoApi?Object:o.VideoApi,void 0===n.FeedApi?Object:n.FeedApi,void 0===c.ShortVideoDeleteService?Object:c.ShortVideoDeleteService,void 0===u.ShortVideoOwnersProvider?Object:u.ShortVideoOwnersProvider,void 0===l.ShortVideoVideosProvider?Object:l.ShortVideoVideosProvider,"undefined"==typeof ShortVideoVideosProviderCompatible?Object:ShortVideoVideosProviderCompatible,"undefined"==typeof ShortVideoOwnersProviderCompatible?Object:ShortVideoOwnersProviderCompatible])],_)},323129:(e,t,i)=>{i.d(t,{FETCH_QUERY:()=>s});const s={fields:["friend_status","is_subscribed","is_member","photo_50","photo_100","photo_200","photo_400","is_nft","about","description","followers_count","members_count","verified"].join(","),count:10}},535452:(e,t,i)=>{i.d(t,{ClipsFeedModel:()=>s.ClipsFeedModel});i(323129);var s=i(687242)},204361:(e,t,i)=>{i.d(t,{getFeedObjectKey:()=>r,getFeedObjectRequestParams:()=>o});var s=i(323129);function r(e){switch(e.feed){case"compilation":return`${e.feed}-${e.compilationId}`;case"effect":return`${e.feed}-${e.effectId}`;case"music":return`${e.feed}-${e.musicId}`;case"hashtag":return`${e.feed}-${e.hashtag}`;case"place":return`${e.feed}-${e.placeId}`;case"ownerFeed":case"postponed":return`${e.feed}-${e.ownerId}`;case"playlist":return`${e.feed}-${e.ownerId}-${e.playlistId}`;case"subscriptions":case"top":return`${e.feed}`;default:throw new Error(`${e.feed} does not support in getFeedObjectKey`)}}function o(e){switch(e.feed){case"compilation":return{filters:JSON.stringify({compilationId:e.compilationId}),...s.FETCH_QUERY};case"effect":return{filters:JSON.stringify({maskId:e.effectId}),...s.FETCH_QUERY};case"music":return{filters:JSON.stringify({audioId:e.musicId}),ref:"clip_grid",...s.FETCH_QUERY};case"hashtag":return{filters:JSON.stringify({tag:`#${e.hashtag}`}),...s.FETCH_QUERY};case"place":return{filters:JSON.stringify({placeId:e.placeId}),...s.FETCH_QUERY};case"top":return{ref:"clips",...s.FETCH_QUERY};case"ownerFeed":return{owner_id:e.ownerId??0,...s.FETCH_QUERY,...e.trackCode?{track_code:e.trackCode}:{}};case"postponed":return{owner_id:e.ownerId??0,playlist:"scheduled",...s.FETCH_QUERY};case"subscriptions":return{filters:"clip",source_ids:"friends,groups,following",...s.FETCH_QUERY};case"playlist":return{owner_id:e.ownerId??0,playlist_id:e.playlistId??0,...s.FETCH_QUERY};default:throw new Error(`${e.feed} does not support in getFeedObjectRequestParams`)}}},270383:(e,t,i)=>{i.d(t,{ClipRestrictionModel:()=>r.ClipRestrictionModel,ClipsFeedModel:()=>s.ClipsFeedModel,ClipsPlayerStatusModel:()=>o.ClipsPlayerStatusModel});var s=i(535452),r=i(670638),o=i(118313)},371512:(e,t,i)=>{i.d(t,{ClipsPlayerStatusModel:()=>n});var s=i(331635),r=i(327813),o=i(132028);class n{constructor(){this.isPlaying=!0,this.isMuted=!0,this.setPlaying=e=>{this.isPlaying=e},this.togglePlay=()=>{this.isPlaying=!this.isPlaying},this.setMuted=e=>{this.isMuted=e},this.toggleMute=()=>{this.isMuted=!this.isMuted},(0,r.makeAutoObservable)(this)}}n=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],n)},118313:(e,t,i)=>{i.d(t,{ClipsPlayerStatusModel:()=>s.ClipsPlayerStatusModel});var s=i(371512)},910401:(e,t,i)=>{i.d(t,{ClipRestrictionModel:()=>a});var s=i(331635),r=i(24516),o=i(327813),n=i(132028);class a{get restrictionEnabled(){return this.userEnv.partConfigEnabled("clips_web_blur_restriction")}constructor(e){this.userEnv=e,this.removedRestrictionMap=new Map,this.setRemovedRestriction=e=>{this.removedRestrictionMap.set(e,!0)},this.getRemovedRestriction=e=>Boolean(this.removedRestrictionMap.get(e)),(0,o.makeAutoObservable)(this)}}a=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.UserEnv?Object:r.UserEnv])],a)},670638:(e,t,i)=>{i.d(t,{ClipRestrictionModel:()=>s.ClipRestrictionModel});var s=i(910401)},536805:(e,t,i)=>{i.d(t,{UPLOAD_AUDIO_RIGHTS_LINK:()=>s,UPLOAD_MAX_VIDEO_SIZE:()=>r});const s="/@vkclips-copyrights-description",r=8589934592},41128:(e,t,i)=>{i.d(t,{UPLOAD_AUDIO_RIGHTS_LINK:()=>r.UPLOAD_AUDIO_RIGHTS_LINK,UPLOAD_MAX_VIDEO_SIZE:()=>r.UPLOAD_MAX_VIDEO_SIZE,UploadAudioSearchModel:()=>s.UploadAudioSearchModel});var s=i(81319),r=i(536805)},726401:(e,t,i)=>{i.d(t,{UploadAudioSearchModel:()=>d});var s=i(331635),r=i(327813),o=i(543116),n=i(132028),a=i(8520);class d{[n.init](){return this.audioClipsList.fetch({})}get audios(){return this.isSearch?this.audioClipsSearchList.items:this.audioClipsList.items}get isLoading(){return this.audioClipsSearchList.isLoading||this.audioClipsList.isLoading}resetQuery(){this.isSearch=!1,this.audioClipsSearchList.reset()}constructor(e,t){this.audioClipsListsProvider=e,this.props=t,this.searchQuery="",this.isSearch=!1,this.searchAudio=e=>{this.searchQuery=e,this.searchAudioDebounced(e)},this.searchAudioDebounced=(0,a.debounce)((e=>{e?((0,r.runInAction)((()=>{this.isSearch=!0})),this.audioClipsSearchList.fetch({query:e})):this.resetQuery()}),200),(0,r.makeAutoObservable)(this),this.audioClipsList=this.audioClipsListsProvider.createSearchList(),this.audioClipsSearchList=this.audioClipsListsProvider.createSearchList()}}d=(0,s.__decorate)([n.scope.transient(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.AudioClipsListsProvider?Object:o.AudioClipsListsProvider,void 0===n.Props?Object:n.Props])],d)},81319:(e,t,i)=>{i.d(t,{UploadAudioSearchModel:()=>s.UploadAudioSearchModel});var s=i(726401)},825753:(e,t,i)=>{i.d(t,{compilePath:()=>r});var s=i(626627);function r(e){return function(e){const t=e.map((e=>{if("object"==typeof e)return new RegExp("^(?:".concat(e.pattern,")$"))}));return i=>{let s="";for(let r=0;r<e.length;r++){const o=e[r];if("string"==typeof o){s+=o;continue}const n=i?i[o.name]:void 0,a="?"===o.modifier||"*"===o.modifier,d="*"===o.modifier||"+"===o.modifier;if(Array.isArray(n)){if(!d)throw new TypeError('Expected "'.concat(o.name.toString(),'" to not repeat, but got an array'));if(0===n.length){if(a)continue;throw new TypeError('Expected "'.concat(o.name.toString(),'" to not be empty'))}for(let e=0;e<n.length;e++){const i=n[e];if(!t[r]?.test(i))throw new TypeError('Expected all "'.concat(o.name.toString(),'" to match "').concat(o.pattern,'", but got "').concat(i,'"'));s+=o.prefix+i+o.suffix}continue}if("string"==typeof n||"number"==typeof n){const e=String(n);if(!t[r]?.test(e))throw new TypeError('Expected "'.concat(o.name.toString(),'" to match "').concat(o.pattern,'", but got "').concat(e,'"'));s+=o.prefix+e+o.suffix;continue}if(a)continue;const h=d?"an array":"a string";throw new TypeError('Expected "'.concat(o.name.toString(),'" to be ').concat(h))}return s}}((0,s.parsePath)(e))}},631435:(e,t,i)=>{i.d(t,{createLink:()=>r});var s=i(825753);function r(e,t,i,r){const o=function(e,t){const i=e.split(".");let s,r=t;do{const t=i.shift();if(!(t in r))throw Error(`Unknown path's segment "${t}" for route key "${e}"`);s=r[t],"routes"in s&&(r=s.routes)}while(i.length>0);return s}(t,e).path,n=i?(0,s.compilePath)(o)(i):o,a=r?new URLSearchParams((d=r,Object.fromEntries(Object.entries(d).map((([e,t])=>[e,t.toString()]))))).toString():"";var d;return`${n}${a?"?"+a:""}`}},162482:(e,t,i)=>{i.d(t,{TypedParamNumber:()=>s});i(308011),i(626627);Symbol("query param string type");const s=Symbol("query param number type")},518235:(e,t,i)=>{i.d(t,{createLink:()=>s.createLink});var s=i(631435);i(162482),i(455805)},626627:(e,t,i)=>{function s(e){const t=function(e){const t=[];let i=0;for(;i<e.length;){const s=e[i];if("*"!==s&&"+"!==s&&"?"!==s)if("\\"!==s)if("{"!==s)if("}"!==s)if(":"!==s)if("("!==s)t.push({type:"CHAR",index:i,value:e[i++]});else{let s=1,r="",o=i+1;if("?"===e[o])throw new TypeError('Pattern cannot start with "?" at '.concat(o.toString()));for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(s--,0===s){o++;break}}else if("("===e[o]&&(s++,"?"!==e[o+1]))throw new TypeError("Capturing groups are not allowed at ".concat(o.toString()));r+=e[o++]}else r+=e[o++]+e[o++];if(s)throw new TypeError("Unbalanced pattern at ".concat(i.toString()));if(!r)throw new TypeError("Missing pattern at ".concat(i.toString()));t.push({type:"PATTERN",index:i,value:r}),i=o}else{let s="",r=i+1;for(;r<e.length;){const t=e.charCodeAt(r);if(!(t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95===t))break;s+=e[r++]}if(!s)throw new TypeError("Missing parameter name at ".concat(i.toString()));t.push({type:"NAME",index:i,value:s}),i=r}else t.push({type:"CLOSE",index:i,value:e[i++]});else t.push({type:"OPEN",index:i,value:e[i++]});else t.push({type:"ESCAPED_CHAR",index:i++,value:e[i++]});else t.push({type:"MODIFIER",index:i,value:e[i++]})}return t.push({type:"END",index:i,value:""}),t}(e),i="[^".concat(function(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}("/#?"),"]+?");let s=[],r=0,o=0,n="";const a=function(e){if(o<t.length&&t[o].type===e)return t[o++].value},d=function(e){const i=a(e);if(void 0!==i)return i;const{type:s,index:r}=t[o];throw new TypeError("Unexpected ".concat(s," at ").concat(r.toString(),", expected ").concat(e))},h=function(){let e,t="";for(;e=a("CHAR")||a("ESCAPED_CHAR");)t+=e;return t};for(;o<t.length;){const e=a("CHAR"),t=a("NAME"),o=a("PATTERN");if(t||o){let d=e||"";"./".includes(d)&&(n+=d,d=""),n&&(s.push(n),n=""),s.push({name:t||r++,prefix:d,suffix:"",pattern:o||i,modifier:a("MODIFIER")||""});continue}const c=e||a("ESCAPED_CHAR");if(c){n+=c;continue}n&&(s.push(n),n="");if(a("OPEN")){const e=h(),t=a("NAME")||"",o=a("PATTERN")||"",n=h();d("CLOSE"),s.push({name:t||(o?r++:""),pattern:t&&!o?i:o,prefix:e,suffix:n,modifier:a("MODIFIER")||""})}else d("END")}return s}i.d(t,{parsePath:()=>s})},455805:(e,t,i)=>{i(162482)},347753:(e,t,i)=>{i.d(t,{getClipCover:()=>r});var s=i(8520);function r(e,t){return function(e,t,i){const r=e.filter((e=>!e.with_padding));return(0,s.getPhotoSize)(r.length?r:e,t,i)?.url}(e.image&&e.image.length?e.image:e.first_frame??[],t.width,t.height)||""}},689110:(e,t,i)=>{i.d(t,{getClipCover:()=>s.getClipCover,isLockedVideo:()=>r.isLockedVideo});var s=i(347753),r=i(123683)},123683:(e,t,i)=>{function s(e){return Boolean(e.owner?.isAdmin)&&Boolean(e.data.privacy_view&&!function(e){return function(e,t){return!e.category||!t.length||t.includes(e.category)}(e,["all","any"])&&0===(e?.excluded_category?.length||0)&&0===(e?.lists?.allowed?.length||0)&&0===(e?.lists?.excluded?.length||0)&&0===(e?.owners?.allowed?.length||0)&&0===(e?.owners?.excluded?.length||0)}(e.data.privacy_view))}i.d(t,{isLockedVideo:()=>s})},110343:(e,t,i)=>{i.d(t,{GET_CHALLENGE_COUNTERS_MAX_RETRIES:()=>s,GET_SHORT_VIDEOS_LIST_MAX_RETRIES:()=>r,SHORT_VIDEO_ALL_FETCH_FIELDS:()=>o,SHORT_VIDEO_ALL_FIELDS:()=>n});const s=2,r=3,o=["friend_status","is_subscribed","is_member","photo_50","photo_100","photo_200","photo_400","is_nft","about","description","followers_count","members_count","verified"],n=o.join(",")},474436:(e,t,i)=>{i.d(t,{ShortVideoFeedNewsVideosProvider:()=>c});var s=i(331635),r=i(882044),o=i(765905),n=i(327813),a=i(132028),d=i(845758),h=i(340514);class c{async fetch(e){const{items:t,groups:i,profiles:s,next_from:r}=await this.feedApi.getNewsFeed(e),o=t.flatMap((e=>e?.clip?.items)).filter(Boolean);let a=[];if(o.length){const t=(await this.videoApi.get({videos:o.map(h.getRawIdFromVideo).join(","),fields:e.fields})).items.reduce(((e,t)=>Object.assign(e,{[(0,h.getRawIdFromVideo)(t)]:t})),{});a=o.map((e=>({...e,...t[(0,h.getRawIdFromVideo)(e)]})))}return(0,n.runInAction)((()=>{a.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),i?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),s?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))})),{items:a,next_from:r,count:0}}createList(e){return new d.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i,s){this.videoApi=e,this.feedApi=t,this.shortVideoVideosProvider=i,this.shortVideoOwnersProvider=s,(0,n.makeAutoObservable)(this)}}c=(0,s.__decorate)([a.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.VideoApi?Object:r.VideoApi,void 0===o.FeedApi?Object:o.FeedApi,"undefined"==typeof ShortVideoVideosProviderCompatible?Object:ShortVideoVideosProviderCompatible,"undefined"==typeof ShortVideoOwnersProviderCompatible?Object:ShortVideoOwnersProviderCompatible])],c)},338454:(e,t,i)=>{i.d(t,{ShortVideoFeedOwnerVideosProvider:()=>d});var s=i(331635),r=i(413206),o=i(132028),n=i(327813),a=i(845758);class d{async fetch(e){const t=await this.shortVideosApi.getOwnerVideos(e);return(0,n.runInAction)((()=>{t.items.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),t.groups?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),t.profiles?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))})),t}createList(e){return new a.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i){this.shortVideosApi=e,this.shortVideoVideosProvider=t,this.shortVideoOwnersProvider=i,(0,n.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoApi?Object:r.ShortVideoApi,"undefined"==typeof ShortVideoVideosProviderCompatible?Object:ShortVideoVideosProviderCompatible,"undefined"==typeof ShortVideoOwnersProviderCompatible?Object:ShortVideoOwnersProviderCompatible])],d)},876922:(e,t,i)=>{i.d(t,{ShortVideoFeedTopVideosProvider:()=>d});var s=i(331635),r=i(413206),o=i(327813),n=i(132028),a=i(845758);class d{async fetch(e){const t=await this.shortVideosApi.getTopVideos(e);return(0,o.runInAction)((()=>{t.items.forEach((e=>this.shortVideoVideosProvider.addVideoFromApi(e))),t.groups?.forEach((e=>this.shortVideoOwnersProvider.addGroupFromApi(e))),t.profiles?.forEach((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e)))})),t}createList(e){return new a.ShortVideoFeed(e,{request:this.fetch.bind(this)})}constructor(e,t,i){this.shortVideosApi=e,this.shortVideoVideosProvider=t,this.shortVideoOwnersProvider=i,(0,o.makeAutoObservable)(this)}}d=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.ShortVideoApi?Object:r.ShortVideoApi,"undefined"==typeof ShortVideoVideosProviderCompatible?Object:ShortVideoVideosProviderCompatible,"undefined"==typeof ShortVideoOwnersProviderCompatible?Object:ShortVideoOwnersProviderCompatible])],d)},845758:(e,t,i)=>{i.d(t,{ShortVideoFeed:()=>n});var s=i(327813),r=i(110343),o=i(340514);class n{reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.fullyLoaded=!1,this.nextFrom="",this.abortController=null}async request(e){this.isLoading=!0,this.abortController=new AbortController;try{const t=await this.provider.request({...e,...this.nextFrom?{start_from:this.nextFrom}:{}},{signal:this.abortController.signal});return(0,s.runInAction)((()=>{this.isLoading=!1,this.abortController=null,this.nextFrom=t.next_from??"",this.count=t.count,this.fullyLoaded=!Boolean(t.next_from),this.ids.push(...t.items.map(o.getRawIdFromVideo))})),this.retryIfNeeded(t)}catch(e){throw(0,s.runInAction)((()=>{this.isLoading=!1,this.abortController=null,this.error=e})),e}}async fetch(){if(!this.isLoading&&!this.fullyLoaded)return this.request(this.requestParams)}async retryIfNeeded(e){if(!e.items.length&&this.retryCount<r.GET_SHORT_VIDEOS_LIST_MAX_RETRIES)return(0,s.runInAction)((()=>{this.retryCount=e.next_from?1:this.retryCount+1})),await this.fetch();(0,s.runInAction)((()=>{this.retryCount=0}))}constructor(e,t){this.requestParams=e,this.provider=t,this.abortController=null,this.nextFrom="",this.retryCount=0,this.ids=[],this.count=0,this.isLoading=!1,this.fullyLoaded=!1,this.error=null,(0,s.makeAutoObservable)(this)}}},340514:(e,t,i)=>{i.d(t,{getRawIdFromVideo:()=>r});var s=i(873900);const r=e=>(0,s.getIdentityRawId)({id:e.id??0,ownerId:e.owner_id??0})},914492:(e,t,i)=>{i.d(t,{ShortVideoOwnersProvider:()=>b});var s=i(331635),r=i(327813),o=i(695368),n=i(132028),a=i(603025),d=i(468073),h=i(488709),c=i(962005),u=i(951652),l=i(903723),p=i(276289),m=i(368014),g=i(317245),v=i(89933);const _=["photo_50","photo_100","photo_200","photo_400","friend_status","is_subscribed","is_member","can_comment","screen_name","verified"].join(",");class b{addOwnerFromApi(e){const t=e.id,i=new g.ShortVideoUserOwner(t,e,this.usersSubscribeService,this.authService);this.ownersMap.set(t,i),e.screen_name&&this.ownersByScreenNameMap.set(e.screen_name,i),this.usersSubscribeService.setMemberStatus(e)}addGroupFromApi(e){const t=d.Ranges.convertGroupIdToOwnerIdStrict(e.id),i=new v.ShortVideoGroupOwner(t,e,this.groupsSubscribeService);this.groupsProvider.createGroupFromApi({apiGroup:e,fields:""}),this.ownersMap.set(t,i),e.screen_name&&this.ownersByScreenNameMap.set(e.screen_name,i)}async ensure(e){const t=this.get(e);return t||this.isError(e)?t:this.fetch(e)}async fetch(e){try{this.pendingSet.add(e),this.errorMap.delete(e),"number"==typeof e?d.Ranges.isGroupId(e)?await this.fetchGroup(e):await this.fetchUser(e):await Promise.all([this.fetchUser(e),this.fetchGroup(e)]),(0,r.runInAction)((()=>{this.pendingSet.delete(e)}))}catch(t){throw(0,r.runInAction)((()=>{this.pendingSet.delete(e),this.errorMap.set(e,t)})),new Error("Error fetch owner",{cause:t})}}get(e){return"string"==typeof e?this.ownersByScreenNameMap.get(e):this.ownersMap.get(e)}isPending(e){return Boolean(this.pendingSet.has(e))}isError(e){return Boolean(this.errorMap.get(e))}async fetchUser(e){const t=await this.usersApi.get({user_ids:`${e}`,fields:_});(0,r.runInAction)((()=>{t.forEach((e=>this.addOwnerFromApi(e)))}))}async fetchGroup(e){try{const t=await this.groupsApi.getById({group_ids:"number"==typeof e?`${d.Ranges.convertOwnerIdToGroupId(e)}`:e,fields:_});(0,r.runInAction)((()=>{t.groups?.forEach((e=>this.addGroupFromApi(e)))}))}catch(t){if(!("string"==typeof e&&t instanceof Error&&(0,a.isApiError)(t)&&t.error.error_code===o.API_ERROR_PARAM))throw new Error("Error fetch group",{cause:t})}}updateOwner(){throw new Error("This method should not be called in ShortVideoOwnersProvider")}constructor(e,t,i,s,o,n){this.groupsProvider=e,this.groupsSubscribeService=t,this.usersSubscribeService=i,this.usersApi=s,this.groupsApi=o,this.authService=n,this.ownersMap=new Map,this.ownersByScreenNameMap=new Map,this.pendingSet=new Set,this.errorMap=new Map,(0,r.makeAutoObservable)(this)}}b=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.GroupsProvider?Object:l.GroupsProvider,void 0===p.GroupsSubscribeService?Object:p.GroupsSubscribeService,void 0===m.ShortVideoUsersSubscribeService?Object:m.ShortVideoUsersSubscribeService,void 0===h.UsersApi?Object:h.UsersApi,void 0===c.GroupsApi?Object:c.GroupsApi,void 0===u.AuthService?Object:u.AuthService])],b)},368014:(e,t,i)=>{i.d(t,{ShortVideoUsersSubscribeService:()=>c});var s=i(331635),r=i(891281),o=i(199313),n=i(208214),a=i(261491),d=i(327813),h=i(132028);class c{getIsMember(e){const t=this.usersMemberStatusMap.get(e);return"number"==typeof t&&(t===r.FriendsFriendStatusStatusEnumNames.OUTCOMING_REQUEST||t===r.FriendsFriendStatusStatusEnumNames.IS_FRIEND)}async subscribe(e){const t=e.user_id;try{this.usersSubscribeStatusPending.set(t,!0);const i=await this.api.add(e);return(0,d.runInAction)((()=>{this.usersMemberStatusMap.set(t,i===o.FriendsAddResponseEnumNames.APPROVED?r.FriendsFriendStatusStatusEnumNames.IS_FRIEND:r.FriendsFriendStatusStatusEnumNames.OUTCOMING_REQUEST)})),!0}finally{(0,d.runInAction)((()=>{this.usersSubscribeStatusPending.delete(t)}))}}async unsubscribe(e){const t=e.user_id;try{this.usersSubscribeStatusPending.set(t,!0);return!!(await this.api.delete(e)).success&&(this.usersMemberStatusMap.set(t,r.FriendsFriendStatusStatusEnumNames.NOT_A_FRIEND),!0)}finally{this.usersSubscribeStatusPending.delete(t)}}getIsLoading(e){return Boolean(this.usersSubscribeStatusPending.get(e))}setMemberStatus(e){e.friend_status&&this.usersMemberStatusMap.set(e.id,e.friend_status)}getMemberStatus(e){return this.usersMemberStatusMap.get(e)}constructor(e,t){this.api=e,this.myTracker=t,this.usersMemberStatusMap=new Map,this.usersSubscribeStatusPending=new Map,(0,d.makeAutoObservable)(this)}}c=(0,s.__decorate)([h.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.FriendsApi?Object:n.FriendsApi,void 0===a.MyTrackerLegacy?Object:a.MyTrackerLegacy])],c)},89933:(e,t,i)=>{i.d(t,{ShortVideoGroupOwner:()=>o});var s=i(327813),r=i(642347);class o{get isSubscribed(){return this.groupsSubscribeService.getIsMember(this.data.id)}get isPendingSubscription(){return this.groupsSubscribeService.getIsLoading(this.data.id)}async subscribe(){return await this.groupsSubscribeService.join({group_id:this.data.id}),!0}async unsubscribe(){return await this.groupsSubscribeService.leave({group_id:this.data.id}),!0}get name(){return this.data.name??""}get screenName(){return this.data.screen_name||`club${this.data.id}`}get isAdmin(){return this.data.admin_level===r.GroupsGroupAdminLevelEnumNames.ADMINISTRATOR}get followersCount(){return this.data.members_count??0}constructor(e,t,i){this.ownerId=e,this.data=t,this.groupsSubscribeService=i,(0,s.makeAutoObservable)(this)}}},317245:(e,t,i)=>{i.d(t,{ShortVideoUserOwner:()=>r});var s=i(327813);class r{get isSubscribed(){return this.usersSubscribeService.getIsMember(this.data.id)}get isPendingSubscription(){return this.usersSubscribeService.getIsLoading(this.data.id)}subscribe(){return this.usersSubscribeService.subscribe({user_id:this.data.id})}unsubscribe(){return this.usersSubscribeService.unsubscribe({user_id:this.data.id})}get name(){return[this.data.first_name,this.data.last_name].filter(Boolean).join(" ").trim()}get screenName(){return this.data.screen_name||`id${this.data.id}`}get isAdmin(){return this.data.id===this.authService.userId}get followersCount(){return this.data.followers_count??0}constructor(e,t,i,r){this.ownerId=e,this.data=t,this.usersSubscribeService=i,this.authService=r,(0,s.makeAutoObservable)(this)}}},291566:(e,t,i)=>{i.d(t,{ShortVideoStatsTokenService:()=>c});var s=i(331635),r=i(132028),o=i(882044),n=i(510454),a=i(627876),d=i(327813);const h="short_video_auth_token";class c{saveToStorage(e){this.localStorage.setItem(h,e)}getFromStorage(){return this.localStorage.getItem(h)}async getFromApi({refresh:e=!1}={}){const t={force_refresh:e?1:0},i=await this.videoApi.getStatsToken(t);if(i)return this.saveToStorage(i.token),i.token}async getToken(e={}){return e.refresh?await this.getFromApi(e):this.getFromStorage()??await this.getFromApi(e)}async trackOneStatError(e){const t=e instanceof Error?e.name:String(e);this.statlog.send({name:"video_player_insignificant_network_error",value:"onestat",keys:[t]})}constructor(e,t,i){this.videoApi=e,this.localStorage=t,this.statlog=i,(0,d.makeAutoObservable)(this)}}c=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.VideoApi?Object:o.VideoApi,void 0===n.LocalStorage?Object:n.LocalStorage,void 0===a.Statlog?Object:a.Statlog])],c)},564616:(e,t,i)=>{i.d(t,{AudioClipsProvider:()=>o});var s=i(327813),r=i(222012);class o{getAudioClip(e){return this.data.audioClipsMap.get(e)}createAudioClipFromApi(e){const t=new r.AudioClip(e);return this.data.audioClipsMap.set(t.rawId,t),t}constructor(){this.data={audioClipsMap:new Map},(0,s.makeAutoObservable)(this)}}},222012:(e,t,i)=>{i.d(t,{AudioClip:()=>o});var s=i(327813),r=i(873900);class o{get rawId(){const{id:e,owner_id:t}=this.data;return(0,r.getIdentityRawId)({id:e,ownerId:t})}constructor(e){this.data=e,(0,s.makeAutoObservable)(this)}}},543116:(e,t,i)=>{i.d(t,{AudioClipsListsProvider:()=>h});var s=i(331635),r=i(327813),o=i(52016),n=i(132028),a=i(564616),d=i(42006);class h{createSearchList(){return new d.AudioClipsSearchList(this.audioClipsProvider,this.catalogApi)}constructor(e,t){this.audioClipsProvider=e,this.catalogApi=t,(0,r.makeAutoObservable)(this)}}h=(0,s.__decorate)([n.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.AudioClipsProvider?Object:a.AudioClipsProvider,void 0===o.CatalogApi?Object:o.CatalogApi])],h)},42006:(e,t,i)=>{i.d(t,{AudioClipsSearchList:()=>r});var s=i(327813);class r{get count(){return this.ids.length}get items(){const e=[];for(const t of this.ids){const i=this.audioClipsProvider.getAudioClip(t);if(!i)return e;e.push(i)}return e}reset(){this.abortController?.abort(),this.resetState()}resetState(){this.ids=[],this.isLoading=!1,this.initialLoad=!1,this.abortController=null}async request(e,t){const i=await this.catalogApi[e.query?"getAudioClipsSearch":"getAudioClips"]({query:e.query,need_blocks:1},{signal:t.signal}),s=i.short_video_audios?"short_video_audios":"audios";return{items:i[s]?.map((e=>this.audioClipsProvider.createAudioClipFromApi(e)))||[]}}async fetch(e){this.abortController&&this.abortController.abort(),this.resetState(),this.isLoading=!0,this.initialLoad||(this.initialLoad=!0),this.abortController=new AbortController;const t=await this.request(e,this.abortController);this.handleResponse(t)}handleResponse(e){this.ids=e.items.map((e=>e.rawId)),this.isLoading=!1,this.abortController=null}constructor(e,t){this.audioClipsProvider=e,this.catalogApi=t,this.ids=[],this.abortController=null,this.initialLoad=!1,this.isLoading=!1,(0,s.makeAutoObservable)(this)}}},509739:(e,t,i)=>{i.d(t,{ShortVideoDeleteService:()=>d});var s=i(331635),r=i(327813),o=i(132028),n=i(882044),a=i(768035);class d{isPending(e){return this.pendingSet.has(e)}isDeleted(e){return this.deletedSet.has(e)}getDeletedClips(){return Array.from(this.deletedSet.values())}async delete(e){if(this.isPending(e))return!1;try{const{id:t,ownerId:i}=(0,a.parseRawId)(e);this.pendingSet.add(e);const s=Boolean(await this.videoApi.delete({video_id:t,owner_id:i}));return(0,r.runInAction)((()=>{s&&this.deletedSet.add(e),this.pendingSet.delete(e)})),s}catch(t){throw(0,r.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot delete video",{cause:t})}}async restore(e){if(this.isPending(e))return!1;try{const{id:t,ownerId:i}=(0,a.parseRawId)(e);this.pendingSet.add(e);const s=Boolean(await this.videoApi.restore({video_id:t,owner_id:i}));return(0,r.runInAction)((()=>{s&&this.deletedSet.delete(e),this.pendingSet.delete(e)})),s}catch(t){throw(0,r.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot restore video",{cause:t})}}constructor(e){this.videoApi=e,this.deletedSet=new Set,this.pendingSet=new Set,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([o.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.VideoApi?Object:n.VideoApi])],d)},905683:(e,t,i)=>{i.d(t,{ShortVideoLikeService:()=>h});var s=i(331635),r=i(132028),o=i(768035),n=i(327813),a=i(413206),d=i(591301);class h{setLikeStatus(e){this.likesMap.set(e.rawId,{count:e.data.likes?.count??0,userLikes:Boolean(e.data.likes?.user_likes)})}isPending(e){return this.pendingSet.has(e)}getLikes(e){return this.likesMap.get(e)}isNotInterested(e){return this.notInterestedSet.has(e)}async setLike(e){if(!this.isPending(e))try{const{id:t,ownerId:i}=(0,o.parseRawId)(e);this.pendingSet.add(e);const s=await this.likesApi.add({type:"video",owner_id:i,item_id:t});(0,n.runInAction)((()=>{this.likesMap.set(e,{count:s.likes,userLikes:!0}),this.pendingSet.delete(e)}))}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot like clip",{cause:t})}}async setDislike(e){if(!this.isPending(e))try{const{id:t,ownerId:i}=(0,o.parseRawId)(e);this.pendingSet.add(e);const s=await this.likesApi.delete({type:"video",owner_id:i,item_id:t});(0,n.runInAction)((()=>{this.likesMap.set(e,{count:s.likes,userLikes:!1}),this.pendingSet.delete(e)}))}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot dislike clip",{cause:t})}}toggleLike(e){return this.getLikes(e)?.userLikes?this.setDislike(e):this.setLike(e)}async setNotInterested(e){if(this.isPending(e)||this.notInterestedSet.has(e))return!1;try{const{id:t,ownerId:i}=(0,o.parseRawId)(e);this.pendingSet.add(e);const s=await this.shortVideoApi.notInterested({video_id:t,owner_id:i});return(0,n.runInAction)((()=>{this.pendingSet.delete(e),this.notInterestedSet.add(e)})),this.likesMap.get(e)?.userLikes&&await this.setDislike(e),Boolean(s)}catch(t){throw(0,n.runInAction)((()=>{this.pendingSet.delete(e)})),new Error("Cannot mark clip as not interested",{cause:t})}}constructor(e,t){this.shortVideoApi=e,this.likesApi=t,this.pendingSet=new Set,this.likesMap=new Map,this.notInterestedSet=new Set,(0,n.makeAutoObservable)(this)}}h=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.ShortVideoApi?Object:a.ShortVideoApi,void 0===d.LikesApi?Object:d.LikesApi])],h)},632520:(e,t,i)=>{i.d(t,{ShortVideoVideosProvider:()=>m});var s=i(331635),r=i(132028),o=i(327813),n=i(873900),a=i(882044),d=i(413206),h=i(692464),c=i(914492),u=i(509739),l=i(905683),p=i(110343);class m{addVideoFromApi(e){const t=new h.ShortVideoVideo(e,this.shortVideoOwnersProvider,this.shortVideoDeleteService);this.videoMap.set(t.rawId,t),this.shortVideoLikeService.setLikeStatus(t)}isPending(e){return this.pendingSet.has(e)}isError(e){return this.errorMap.has(e)}get(e){return this.videoMap.get(e)}async fetch(e,t){const i=e.videos?.split(",")??[];try{i.forEach((e=>this.pendingSet.add(e)));const s=await this.videoApi.get(e,t);return(0,o.runInAction)((()=>{s.items.map((e=>this.addVideoFromApi(e))),s.profiles?.map((e=>this.shortVideoOwnersProvider.addOwnerFromApi(e))),s.groups?.map((e=>this.shortVideoOwnersProvider.addGroupFromApi(e)))})),s}catch(e){throw(0,o.runInAction)((()=>{i.forEach((t=>this.errorMap.set(t,e)))})),new Error("Fetch video failed",{cause:e})}finally{(0,o.runInAction)((()=>{i.forEach((e=>this.pendingSet.delete(e)))}))}}async fetchAllFields(e){return this.fetch({videos:`${e}`,fields:p.SHORT_VIDEO_ALL_FIELDS,extended:1})}async update(e,t){const i=(0,n.getIdentityRawId)({id:e.video_id,ownerId:e.owner_id});try{this.pendingSet.add(i),await this.shortVideoApi.edit(e,t)}finally{this.pendingSet.delete(i)}}constructor(e,t,i,s,r){this.shortVideoOwnersProvider=e,this.videoApi=t,this.shortVideoApi=i,this.shortVideoDeleteService=s,this.shortVideoLikeService=r,this.videoMap=new Map,this.pendingSet=new Set,this.errorMap=new Map,(0,o.makeAutoObservable)(this)}}m=(0,s.__decorate)([r.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.ShortVideoOwnersProvider?Object:c.ShortVideoOwnersProvider,void 0===a.VideoApi?Object:a.VideoApi,void 0===d.ShortVideoApi?Object:d.ShortVideoApi,void 0===u.ShortVideoDeleteService?Object:u.ShortVideoDeleteService,void 0===l.ShortVideoLikeService?Object:l.ShortVideoLikeService])],m)},692464:(e,t,i)=>{i.d(t,{ShortVideoVideo:()=>o});var s=i(327813),r=i(873900);class o{get rawId(){const{id:e=0,owner_id:t=0}=this.data;return(0,r.getIdentityRawId)({id:e,ownerId:t})}get isDeleted(){return this.shortVideoDeleteService.isDeleted(this.rawId)}get isPendingDelete(){return this.shortVideoDeleteService.isPending(this.rawId)}get owner(){return this.data.owner_id?this.shortVideoOwnersProvider.get(this.data.owner_id):void 0}constructor(e,t,i){this.data=e,this.shortVideoOwnersProvider=t,this.shortVideoDeleteService=i,(0,s.makeAutoObservable)(this)}}},852487:(e,t,i)=>{i.d(t,{VideoPlayerConfigProvider:()=>d});var s=i(331635),r=i(327813),o=i(882044),n=i(955060),a=i(132028);class d{isLoading(e){return Boolean(this.requestMap.get(e))}async request(e){return this.abortController=new AbortController,this.videoApi.getPlayerConfig(e,{signal:this.abortController?.signal})}async fetch(e){this.reset();try{const t=await this.request(e);return this.configMap.set(e.module,t.config),t.config}catch(e){return this.errorLogger.log(new Error("Video player config fetching failed",{cause:e})),null}finally{this.requestMap.delete(e.module)}}async ensure(e){const t=this.requestMap.get(e.module);if(t)return t;const i=this.configMap.get(e.module);if(i)return i;const s=this.fetch(e);return this.requestMap.set(e.module,s),s}reset(){this.configMap.clear(),this.requestMap.clear(),this.abortController?.abort()}constructor(e,t){this.videoApi=e,this.errorLogger=t,this.abortController=null,this.configMap=new Map,this.requestMap=new Map,(0,r.makeAutoObservable)(this)}}d=(0,s.__decorate)([a.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.VideoApi?Object:o.VideoApi,void 0===n.ErrorLogger?Object:n.ErrorLogger])],d)},979549:(e,t,i)=>{i.d(t,{VideoViewSegmentsService:()=>u});var s=i(331635),r=i(327813),o=i(882044),n=i(957831),a=i(695368),d=i(132028),h=i(603025),c=i(236737);class u{async send(e){try{return await this.videoApi.viewSegments(e)}catch(e){if(this.isVideoDeletedError(e))return n.VideoViewSegmentsResponseEnumNames.NOT_LOGGED;throw e}}isVideoDeletedError(e){return(0,h.isApiError)(e)&&e.error.error_code===a.API_ERROR_REQUEST&&e.error.error_msg.includes(c.VIDEO_NOT_FOUND)}constructor(e){this.videoApi=e,(0,r.makeAutoObservable)(this)}}u=(0,s.__decorate)([d.scope.container(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.VideoApi?Object:o.VideoApi])],u)},236737:(e,t,i)=>{i.d(t,{VIDEO_NOT_FOUND:()=>s});const s="video not found"},765905:(e,t,i)=>{i.d(t,{FeedApi:()=>n});var s=i(331635),r=i(641569),o=i(132028);class n extends r.ApiNamespace{get namespace(){return"newsfeed"}constructor(...e){super(...e),this.getNewsFeed=this.makeMethod("get"),this.ignoreItem=this.makeMethod("ignoreItem"),this.getBanned=this.makeMethod("getBanned"),this.deleteBan=this.makeMethod("deleteBan"),this.setFeedType=this.makeMethod("setFeedType"),this.unignoreItem=this.makeMethod("unignoreItem"),this.unsubscribe=this.makeMethod("unsubscribe")}}n=(0,s.__decorate)([o.scope.global()],n)},413206:(e,t,i)=>{i.d(t,{ShortVideoApi:()=>n});var s=i(331635),r=i(132028),o=i(641569);class n extends o.ApiNamespace{get namespace(){return"shortVideo"}constructor(...e){super(...e),this.getOwnerVideos=this.makeMethod("getOwnerVideos"),this.getChallenge=this.makeMethod("getChallenge"),this.getClipCounters=this.makeMethod("getClipCounters"),this.create=this.makeMethod("create"),this.edit=this.makeMethod("edit"),this.publish=this.makeMethod("publish"),this.getTopVideos=this.makeMethod("getTopVideos"),this.sendPush=this.makeMethod("sendPush"),this.getGroupsForUploading=this.makeMethod("getGroupsForUploading"),this.notInterested=this.makeMethod("notInterested"),this.getPlaylists=this.makeMethod("getPlaylists"),this.addToPlaylist=this.makeMethod("addToPlaylist"),this.removeFromPlaylist=this.makeMethod("removeFromPlaylist"),this.getDownloadUrl=this.makeMethod("getDownloadUrl"),this.getTopTags=this.makeMethod("getTopTags")}}n=(0,s.__decorate)([r.scope.global()],n)},308011:(e,t,i)=>{i.d(t,{isNotEmptyQuery:()=>s});const s=".*[^ ].*"}}]);try{stManager?.done("dist/web/chunks/176b6c4e.abe547b8.js")}catch(e){}